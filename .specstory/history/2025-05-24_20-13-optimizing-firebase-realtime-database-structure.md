<!-- Generated by SpecStory -->

# Optimizing Firebase Realtime Database Structure (2025-05-24 15:13:23)

_**User**_

Your task is to help me with gathering and creating the optimized data needed to implement into my firebase  Real Time Database. @https://firebase.google.com/docs/database 
  Think of your Realtime Database as one giant, flexible JSON tree. Everything lives in this single tree structure. Unlike a traditional relational database with tables, rows, and columns, here you're designing paths and nodes within this tree.
The key principle, as highlighted in the facts you provided, is this: you need to plan for how data is going to be saved and later retrieved. Your read and write patterns should heavily influence how you structure your JSON tree.
Here are some core concepts and best practices for structuring data in the Realtime Database, especially keeping in mind you're working with a web app and JavaScript/TypeScript:
Think About Your Access Patterns: Before you write a single line of code that interacts with the database, think about the different screens or features in your "woody-vacation-planning-tool" app. What data does each feature need ? How will you query for it? How will you display it? Designing your structure around these needs is vital.
Flatten Your Data (Avoid Deep Nesting): This is a big one! Because retrieving data from a location in the tree also retrieves all of its children, deeply nested data can become very inefficient. If you only need a small piece of information deep within a large structure, you still have to download everything above and below it at that path.
Instead of: users/user1/vacation_plans/planA/destinations/dest1/...
Consider: Having separate top-level nodes or flatter structures that link to each other using IDs.
Use Lists Effectively: To represent collections of items (like a list of vacation plans for a user, or a list of tasks within a plan), use parent nodes that contain child nodes with unique keys. The best way to generate these unique keys is using the push() method in the SDK. This creates unique, chronological keys (often called "push IDs") that are perfect for lists like posts, users, chat messages, etc.
Example: vacation_plans/{planId}/tasks/{taskId}
Denormalize Data (When It Makes Sense): Coming from a relational database background, the idea of storing the same piece of data in multiple places might seem wrong. But in Realtime Database, denormalization is often necessary and beneficial for performance.
Why? To avoid complex, multi-path lookups for common data. If you need to show a user's name next to every comment they make, store the user's name with the comment data, even though it's also stored in the user's profile.
This makes reads faster (one fetch instead of two or more), but means you have to update the data in multiple places if the original data changes (e.g., if a user changes their name). This is where update() operations can be helpful for writing to multiple locations atomically, or using Cloud Functions to handle updates across nodes.
Cross-Reference Data Using IDs: Connect related data by storing the ID of one item within another. For instance, a vacation plan might store the ID of the user who created it, and a user's node might have a list of IDs of the vacation plans they belong to.
Structure for Querying: Remember that Realtime Database queries work best on a specific path and can filter or order child nodes based on keys or values. You cannot easily query across different top-level nodes or perform complex joins like in SQL. Your data structure should facilitate the queries you need to run. For example, if you often need to find all plans shared with a specific user, you might maintain a separate list structured like user_shared_plans/{userId}/{planId}: true .

Structuring data is an iterative process. It's okay to start simple and refine your structure as your app's needs evolve. The most important part is to consciously think about how you will use the data before you store it.

---

_**Assistant**_



---

I'll help you design an optimized Firebase Realtime Database structure for your Disney vacation planning app. Based on your project structure and the features I can see, let me create a comprehensive data model that follows Firebase best practices.

---

<details>
            <summary>Searched codebase "vacation itinerary planning data models types interfaces" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `src/db/schema/itineraries.ts` | L1-42 |
| `src/components/itinerary/ItineraryList.tsx` | L52-58 |
| `src/engines/itinerary/optimizer.ts` | L97-119 |
| `src/app/api/itinerary/route.ts` | L1-47 |
| `src/components/itinerary/ItineraryPlanner.tsx` | L111-144 |
| `dataconnect/schema/schema.gql` | L1-97 |
| `firebase/dataconnect/schema.graphqls` | L1-96 |
| `src/lib/firebase/vacations.ts` | L1-16 |
| `src/lib/schemas/itinerary.schema.ts` | L69-92 |
| `src/engines/itinerary/optimizer.ts` | L1-25 |
| `src/lib/schemas/itinerary.schema.ts` | L32-67 |
| `src/components/group/CollaborativeItinerary.tsx` | L50-55 |
| `src/components/group/CollaborativeItinerary.tsx` | L96-100 |
| `src/app/dashboard/optimizer/page.tsx` | L133-156 |
| `src/components/calendar/VacationCalendar.tsx` | L139-208 |
| `src/db/schema/vacations.ts` | L1-38 |
| `src/lib/schemas/itinerary.schema.ts` | L16-30 |
| `src/app/api/itinerary/route.ts` | L79-119 |
| `src/components/group/CollaborativeItinerary.tsx` | L55-78 |
| `src/db/schema.ts` | L1-12 |
| `src/engines/itinerary/optimizer.ts` | L119-135 |
| `src/lib/schemas/itinerary.schema.ts` | L95-115 |
| `src/app/dashboard/optimizer/components/optimizer-results.tsx` | L70-79 |
| `src/app/api/itinerary/route.ts` | L47-79 |
| `src/components/photos/PhotoPassSmartIntegration.tsx` | L95-121 |

</details>

---



---

<details>
            <summary>Searched codebase "park attractions wait times real-time data structure types" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `src/engines/itinerary/optimizer.ts` | L173-228 |
| `src/engines/itinerary/optimizer.ts` | L1023-1056 |
| `src/engines/waitTimes/index.ts` | L37-42 |
| `src/engines/waitTimes/index.ts` | L327-363 |
| `src/components/parks/ParkMap.tsx` | L34-41 |
| `src/engines/itinerary/optimizer.ts` | L135-173 |
| `src/engines/waitTimes/index.ts` | L249-274 |
| `src/types/api.ts` | L43-62 |
| `src/engines/waitTimes/index.ts` | L83-111 |
| `src/components/attractions/AttractionMapOverlay.tsx` | L24-76 |
| `src/lib/services/map-service.ts` | L140-168 |
| `src/hooks/useWaitTimes.ts` | L113-147 |
| `src/components/parks/ParkMap.tsx` | L41-49 |
| `src/app/dashboard/optimizer/components/attraction-preferences.tsx` | L29-46 |
| `src/hooks/useWaitTimes.ts` | L1-15 |
| `src/engines/itinerary/optimizer.ts` | L443-463 |
| `src/components/parks/ParkExplorer.tsx` | L41-99 |
| `src/app/api/attractions/[attractionId]/wait-times/route.ts` | L108-148 |
| `src/components/dashboard/ParkDashboard.tsx` | L175-195 |
| `docs/Disney Vacation Planning, API Integration_.txt` | L192-205 |
| `src/components/parks/ParkMap.tsx` | L219-244 |
| `src/components/parks/ParkExplorer.tsx` | L140-165 |
| `src/engines/itinerary/optimizer.ts` | L554-577 |
| `src/hooks/useWaitTimes.ts` | L77-113 |
| `src/components/attractions/WaitTimesDashboard.tsx` | L208-255 |

</details>

---



---

<details>
            <summary>Searched codebase "group sharing budget tracking user location collaboration" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `src/components/group/LocationSharing.tsx` | L104-118 |
| `src/components/group/LocationSharing.tsx` | L480-512 |
| `src/components/group/GroupCoordination.tsx` | L78-95 |
| `src/components/group/LocationSharing.tsx` | L59-74 |
| `src/components/group/AdvancedLocationTracker.tsx` | L418-469 |
| `src/components/group/LocationSharing.tsx` | L142-169 |
| `src/lib/services/map-service.ts` | L78-117 |
| `src/components/group/AdvancedLocationTracker.tsx` | L469-524 |
| `src/components/group/LocationSharing.tsx` | L1-59 |
| `src/components/group/GroupCoordination.tsx` | L506-560 |
| `src/components/group/GroupCoordination.tsx` | L187-218 |
| `src/components/group/GroupCoordination.tsx` | L1147-1173 |
| `src/components/group/LocationSharing.tsx` | L92-104 |
| `src/components/group/AdvancedLocationTracker.tsx` | L72-84 |
| `src/components/group/LocationSharing.tsx` | L220-266 |
| `src/components/group/AdvancedLocationTracker.tsx` | L820-852 |
| `src/components/group/LocationSharing.tsx` | L589-608 |
| `src/components/group/LocationSharing.tsx` | L325-387 |
| `src/components/group/LocationSharing.tsx` | L118-142 |
| `src/db/schema/locations.ts` | L103-127 |
| `src/components/group/GroupCoordination.tsx` | L856-898 |
| `src/components/calendar/VacationCalendar.tsx` | L944-992 |
| `src/components/group/GroupCoordination.tsx` | L808-856 |
| `src/components/group/LocationSharing.tsx` | L608-629 |
| `src/app/dashboard/group/[vacationId]/page.tsx` | L266-282 |

</details>

---



---

Based on your Disney vacation planning app and the Firebase Realtime Database best practices from the [documentation](https://firebase.google.com/docs/database/web/structure-data), I'll design an optimized data structure that follows the key principles of flattening data, denormalization, and optimizing for your specific access patterns.

## Comprehensive Firebase Realtime Database Structure

```json
{
  // =============================================================================
  // USER DATA & PROFILES
  // =============================================================================
  "users": {
    "$userId": {
      "profile": {
        "displayName": "John Doe",
        "email": "john@example.com",
        "photoURL": "https://...",
        "phoneNumber": "+1234567890",
        "createdAt": 1704067200000,
        "lastActive": 1704153600000
      },
      "preferences": {
        "partySize": 4,
        "hasChildren": true,
        "childrenAges": [6, 10],
        "mobilityConsiderations": false,
        "ridePreference": "family",
        "maxWaitTime": 60,
        "useGeniePlus": true,
        "walkingPace": "moderate",
        "notifications": {
          "waitTimes": true,
          "groupMessages": true,
          "emergencyAlerts": true
        }
      },
      "vacationIds": {
        "$vacationId": true,
        "$vacationId2": true
      },
      "deviceTokens": {
        "$tokenId": {
          "token": "fcm_token_string",
          "platform": "ios",
          "lastUpdated": 1704153600000
        }
      }
    }
  },

  // =============================================================================
  // VACATION MANAGEMENT
  // =============================================================================
  "vacations": {
    "$vacationId": {
      "basic": {
        "name": "Disney World 2024",
        "description": "Family vacation to Disney World",
        "destination": "Walt Disney World",
        "startDate": "2024-03-15",
        "endDate": "2024-03-22",
        "createdBy": "$userId",
        "createdAt": 1704067200000,
        "updatedAt": 1704153600000,
        "status": "planning", // planning, confirmed, active, completed
        "imageUrl": "https://...",
        "shareCode": "ABC123"
      },
      "members": {
        "$userId": {
          "role": "owner", // owner, editor, viewer
          "joinedAt": 1704067200000,
          "permissions": {
            "editItinerary": true,
            "manageBudget": true,
            "inviteOthers": false
          }
        },
        "$userId2": {
          "role": "editor",
          "joinedAt": 1704067300000,
          "permissions": {
            "editItinerary": true,
            "manageBudget": false,
            "inviteOthers": false
          }
        }
      },
      "accommodation": {
        "resortId": "grand-floridian",
        "resortName": "Disney's Grand Floridian Resort & Spa",
        "roomType": "Standard Room",
        "checkIn": "2024-03-15",
        "checkOut": "2024-03-22",
        "confirmationNumber": "12345678"
      },
      "travelers": {
        "adults": 2,
        "children": 2,
        "childrenAges": [6, 10]
      }
    }
  },

  // =============================================================================
  // ITINERARIES & DAILY PLANS
  // =============================================================================
  "itineraries": {
    "$itineraryId": {
      "basic": {
        "vacationId": "$vacationId",
        "userId": "$userId",
        "name": "Magic Kingdom Day 1",
        "date": "2024-03-16",
        "parkId": "magic-kingdom",
        "status": "draft", // draft, finalized, active
        "createdAt": 1704067200000,
        "updatedAt": 1704153600000,
        "optimizedAt": 1704153600000
      },
      "activities": {
        "$activityId": {
          "type": "attraction", // attraction, dining, show, rest, transportation
          "name": "Space Mountain",
          "attractionId": "space-mountain",
          "startTime": "09:00",
          "endTime": "09:30",
          "estimatedWaitTime": 45,
          "actualWaitTime": 30,
          "lightningLane": {
            "type": "GENIE_PLUS",
            "returnTime": "09:15-10:15",
            "used": true
          },
          "notes": "First ride of the day!",
          "status": "completed", // planned, in-progress, completed, skipped
          "priority": 5,
          "location": {
            "latitude": 28.4191,
            "longitude": -81.5769
          }
        }
      },
      "preferences": {
        "partySize": 4,
        "maxWaitTime": 60,
        "useGeniePlus": true,
        "walkingPace": "moderate",
        "breakDuration": 90
      }
    }
  },

  // =============================================================================
  // PARKS & STATIC DATA
  // =============================================================================
  "parks": {
    "magic-kingdom": {
      "name": "Magic Kingdom",
      "description": "The most magical place on earth",
      "coordinates": {
        "latitude": 28.4177,
        "longitude": -81.5812
      },
      "operatingHours": {
        "2024-03-16": {
          "open": "09:00",
          "close": "23:00",
          "extraMagicHours": {
            "type": "evening",
            "start": "23:00",
            "end": "01:00"
          }
        }
      },
      "areas": {
        "fantasyland": {
          "name": "Fantasyland",
          "coordinates": {
            "latitude": 28.4202,
            "longitude": -81.5795
          }
        }
      }
    }
  },

  "attractions": {
    "space-mountain": {
      "name": "Space Mountain",
      "parkId": "magic-kingdom",
      "areaId": "tomorrowland",
      "type": "RIDE",
      "description": "An indoor roller coaster in complete darkness",
      "heightRequirement": "44in (112cm)",
      "thrill": ["Dark Ride", "Thrill"],
      "tags": ["indoor", "popular", "iconic"],
      "duration": 3,
      "capacity": 2400, // hourly capacity
      "coordinates": {
        "latitude": 28.4191,
        "longitude": -81.5769
      },
      "lightningLane": {
        "available": true,
        "type": "GENIE_PLUS"
      },
      "accessibility": {
        "wheelchairAccess": false,
        "serviceAnimalAccess": false,
        "assistiveListening": true
      }
    }
  },

  // =============================================================================
  // REAL-TIME WAIT TIMES
  // =============================================================================
  "liveWaitTimes": {
    "magic-kingdom": {
      "lastUpdated": 1704153600000,
      "attractions": {
        "space-mountain": {
          "status": "OPERATING", // OPERATING, DOWN, CLOSED
          "standbyWait": 45,
          "lightningLane": {
            "available": true,
            "nextReturnTime": "14:30-15:30",
            "price": null // null for Genie+, number for ILL
          },
          "lastUpdated": 1704153600000
        },
        "seven-dwarfs": {
          "status": "OPERATING",
          "standbyWait": 75,
          "lightningLane": {
            "available": true,
            "nextReturnTime": "16:00-17:00",
            "price": 12 // Individual Lightning Lane
          },
          "lastUpdated": 1704153600000
        }
      }
    }
  },

  // =============================================================================
  // BUDGET & EXPENSES
  // =============================================================================
  "budgets": {
    "$vacationId": {
      "total": 5000,
      "spent": 2350,
      "categories": {
        "accommodation": {
          "planned": 2000,
          "actual": 1980
        },
        "tickets": {
          "planned": 1500,
          "actual": 1560
        },
        "dining": {
          "planned": 800,
          "actual": 650
        },
        "souvenirs": {
          "planned": 300,
          "actual": 160
        },
        "transportation": {
          "planned": 400,
          "actual": 0
        }
      },
      "expenses": {
        "$expenseId": {
          "amount": 89.50,
          "category": "dining",
          "description": "Lunch at Be Our Guest",
          "date": "2024-03-16",
          "paidBy": "$userId",
          "splitWith": ["$userId2"],
          "receipt": "https://...",
          "location": "Magic Kingdom",
          "timestamp": 1704153600000
        }
      }
    }
  },

  // =============================================================================
  // GROUP COLLABORATION & CHAT
  // =============================================================================
  "groupMessages": {
    "$vacationId": {
      "$messageId": {
        "userId": "$userId",
        "userName": "John Doe",
        "userPhotoURL": "https://...",
        "content": "Let's meet at Space Mountain in 30 minutes!",
        "timestamp": 1704153600000,
        "type": "text", // text, location, photo, poll
        "reactions": {
          "$userId2": "👍",
          "$userId3": "❤️"
        },
        "replyTo": "$messageId", // for threaded conversations
        "edited": false,
        "editedAt": null
      }
    }
  },

  "groupPolls": {
    "$vacationId": {
      "$pollId": {
        "question": "Which park should we visit tomorrow?",
        "options": {
          "option1": {
            "text": "EPCOT",
            "votes": ["$userId", "$userId2"]
          },
          "option2": {
            "text": "Hollywood Studios",
            "votes": ["$userId3"]
          }
        },
        "createdBy": "$userId",
        "createdAt": 1704153600000,
        "expiresAt": 1704240000000,
        "status": "active" // active, closed
      }
    }
  },

  // =============================================================================
  // REAL-TIME LOCATION SHARING
  // =============================================================================
  "groupLocations": {
    "$vacationId": {
      "members": {
        "$userId": {
          "userName": "John Doe",
          "userPhotoURL": "https://...",
          "isSharing": true,
          "lastUpdated": 1704153600000,
          "location": {
            "latitude": 28.4191,
            "longitude": -81.5769,
            "accuracy": 10,
            "parkId": "magic-kingdom",
            "areaId": "tomorrowland",
            "attractionId": "space-mountain",
            "name": "Space Mountain Queue"
          },
          "activity": "in_queue", // walking, in_queue, dining, resting
          "eta": {
            "toNextMeetup": 15, // minutes
            "confidence": "high"
          }
        }
      },
      "updates": {
        "$updateId": {
          "userId": "$userId",
          "userName": "John Doe",
          "location": {
            "latitude": 28.4191,
            "longitude": -81.5769,
            "name": "Space Mountain",
            "parkId": "magic-kingdom"
          },
          "message": "In line for Space Mountain, about 30 minutes wait",
          "timestamp": 1704153600000,
          "isEmergency": false
        }
      }
    }
  },

  // =============================================================================
  // CALENDAR EVENTS & SCHEDULING
  // =============================================================================
  "events": {
    "$vacationId": {
      "$eventId": {
        "type": "dining", // dining, attraction, show, transportation, rest
        "title": "Dinner at Be Our Guest",
        "description": "Beast's Castle dinner reservation",
        "date": "2024-03-16",
        "startTime": "18:00",
        "endTime": "20:00",
        "location": {
          "name": "Be Our Guest Restaurant",
          "parkId": "magic-kingdom",
          "coordinates": {
            "latitude": 28.4202,
            "longitude": -81.5795
          }
        },
        "attendees": ["$userId", "$userId2"],
        "reservation": {
          "confirmationNumber": "12345",
          "partySize": 4,
          "specialRequests": "Birthday celebration"
        },
        "reminders": {
          "60": true, // 60 minutes before
          "15": true  // 15 minutes before
        },
        "budget": {
          "estimated": 120,
          "actual": 135,
          "category": "dining"
        },
        "status": "confirmed", // planned, confirmed, completed, cancelled
        "createdBy": "$userId",
        "createdAt": 1704153600000
      }
    }
  },

  // =============================================================================
  // NOTIFICATIONS & ALERTS
  // =============================================================================
  "notifications": {
    "$userId": {
      "$notificationId": {
        "type": "wait_time_alert", // wait_time_alert, group_message, location_alert, schedule_reminder
        "title": "Wait Time Alert",
        "message": "Space Mountain wait time dropped to 20 minutes!",
        "data": {
          "attractionId": "space-mountain",
          "waitTime": 20,
          "parkId": "magic-kingdom"
        },
        "timestamp": 1704153600000,
        "read": false,
        "vacationId": "$vacationId"
      }
    }
  },

  // =============================================================================
  // GEOFENCES & LOCATION ALERTS
  // =============================================================================
  "geofences": {
    "$geofenceId": {
      "name": "Space Mountain Area",
      "type": "attraction", // attraction, dining, emergency, custom
      "center": {
        "latitude": 28.4191,
        "longitude": -81.5769
      },
      "radius": 50, // meters
      "parkId": "magic-kingdom",
      "attractionId": "space-mountain",
      "triggers": {
        "entry": true,
        "exit": true,
        "waitTimeChange": true
      },
      "subscribers": {
        "$vacationId": {
          "$userId": true,
          "$userId2": true
        }
      },
      "active": true
    }
  },

  "geofenceAlerts": {
    "$vacationId": {
      "$alertId": {
        "geofenceId": "$geofenceId",
        "userId": "$userId",
        "type": "entry", // entry, exit, wait_time_change
        "message": "John entered Space Mountain area",
        "timestamp": 1704153600000,
        "data": {
          "attractionId": "space-mountain",
          "currentWaitTime": 35
        }
      }
    }
  },

  // =============================================================================
  // OPTIMIZATION & RECOMMENDATIONS
  // =============================================================================
  "optimizationResults": {
    "$itineraryId": {
      "generatedAt": 1704153600000,
      "parameters": {
        "maxWaitTime": 60,
        "useGeniePlus": true,
        "walkingPace": "moderate"
      },
      "stats": {
        "totalAttractions": 8,
        "expectedWaitTime": 180,
        "walkingDistance": 3.2,
        "lightningLaneUsage": 3,
        "coveragePercentage": 85
      },
      "alternatives": {
        "rainyDay": ["$activityId1", "$activityId2"],
        "lowWaitTime": ["$activityId3", "$activityId4"]
      }
    }
  },

  // =============================================================================
  // SHARING & ACCESS CONTROL
  // =============================================================================
  "sharedVacations": {
    "$shareCode": {
      "vacationId": "$vacationId",
      "createdBy": "$userId",
      "expiresAt": 1704240000000,
      "permissions": {
        "view": true,
        "edit": false,
        "comment": true
      },
      "accessCount": 5,
      "lastAccessed": 1704153600000
    }
  },

  // =============================================================================
  // SYSTEM METADATA & ANALYTICS
  // =============================================================================
  "systemMetadata": {
    "lastWaitTimeUpdate": 1704153600000,
    "parkScheduleVersion": "v2024.1",
    "maintenanceMode": false,
    "featureFlags": {
      "realTimeLocations": true,
      "advancedOptimizer": true,
      "voiceCommands": false
    }
  }
}
```

## Key Design Principles Applied

### 1. **Flattened Structure**
- Avoided deep nesting by creating separate top-level nodes for different data types
- Used references (IDs) to connect related data instead of nesting objects
- Example: `users` → `vacations` → `itineraries` are separate collections linked by IDs

### 2. **Denormalized for Performance**
- User names and photos are duplicated in messages and location updates for fast rendering
- Basic vacation info is stored separately from detailed itinerary data
- Wait times are denormalized by park for efficient real-time updates

### 3. **Optimized Access Patterns**

**User Dashboard**: `users/$userId/vacationIds` → `vacations/$vacationId/basic`

**Vacation Details**: `vacations/$vacationId` → `itineraries`, `budgets`, `events`

**Real-time Chat**: `groupMessages/$vacationId` (auto-synced)

**Location Sharing**: `groupLocations/$vacationId/members` (real-time updates)

**Wait Times**: `liveWaitTimes/$parkId/attractions` (optimized for park-specific queries)

### 4. **Scalable Real-time Features**
- **Chat messages**: Partitioned by vacation for efficient querying
- **Location updates**: Separated current status from historical updates
- **Wait times**: Organized by park with timestamps for caching
- **Notifications**: User-specific collections for fast delivery

### 5. **Security & Privacy Considerations**
- User location sharing with granular permissions
- Vacation sharing with expiring access codes
- Role-based access control for vacation members
- Separate sensitive data (preferences) from public data

### 6. **Efficient Querying**
- All time-based data includes timestamps for ordering
- Boolean flags for quick filtering (isSharing, active, etc.)
- Indexed structures for common queries (by park, by user, by vacation)

This structure enables efficient real-time collaboration, scalable wait time updates, and responsive user experiences while following Firebase Realtime Database best practices for performance and cost optimization.

---

_**User**_

Your task is to ensure the project already has this implemented properly in this project. 

You'll use the Firebase Realtime Database SDK for web. Assuming you've already initialized your Firebase app in your project, you'll import the necessary functions:

import { getDatabase, ref, push, set, get, update, remove, onValue, off } from 'firebase/database';
import { getAuth } from 'firebase/auth'; // Assuming you're using Auth for user IDs

// Get the database instance
const database = getDatabase();
const auth = getAuth();
const currentUser = auth.currentUser; // Get the currently signed-in user



---

_**Assistant**_



---

I'll help you ensure your Disney vacation planning project has Firebase Realtime Database properly implemented. Let me first examine your current Firebase setup and then provide the necessary implementations.

---

<details>
            <summary>Searched codebase "firebase config initialization database realtime" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `src/lib/firebase/firebase.config.ts` | L1-33 |
| `src/lib/firebase/firebase-admin.ts` | L20-62 |
| `src/lib/firebase/firebase-admin.ts` | L67-72 |
| `src/lib/utils/offline-storage.ts` | L1-20 |
| `src/lib/firebase/config.ts` | L1-2 |
| `src/lib/firebase/firebase-admin.ts` | L62-67 |
| `docs/Disney Vacation Planning, API Integration_.txt` | L99-109 |
| `docs/FIREBASE_SETUP.md` | L1-55 |
| `src/lib/schemas/user.schema.ts` | L8-23 |
| `next.config.ts` | L39-96 |
| `src/db/schema/users.ts` | L1-19 |
| `src/lib/firebase/contact.ts` | L11-48 |
| `next.config.ts` | L1-39 |
| `src/lib/firebase/contact.ts` | L1-11 |
| `src/lib/firebase/firebase-admin.ts` | L1-20 |
| `src/lib/utils/offline-storage.ts` | L86-133 |
| `src/lib/schemas/user.schema.ts` | L1-8 |
| `src/lib/utils/offline-storage.ts` | L144-201 |
| `src/lib/firebase/auth.ts` | L69-79 |
| `src/lib/firebase/auth.ts` | L97-102 |
| `src/lib/firebase/auth-session.ts` | L1-21 |
| `src/lib/utils/offline-storage.ts` | L201-239 |
| `src/lib/utils/offline-storage.ts` | L342-387 |
| `src/lib/firebase/auth.ts` | L1-32 |
| `src/lib/utils/offline-storage.ts` | L427-455 |

</details>

---

Read file: src/lib/firebase/firebase.config.ts

---

Could not find file .env.example in the workspace.

---

<details>
            <summary>Searched codebase ".env" • **0** results</summary>
        
No results found
</details>

---

I can see that your project has Firebase configured, but **Firebase Realtime Database is missing** from your current setup. You currently have Firestore, Auth, Storage, and Analytics configured, but not the Realtime Database. Let me help you add the necessary configuration and implementation following the [Firebase JavaScript SDK best practices](https://firebase.google.com/docs/web/best-practices).

---

```diff
  import { getStorage } from 'firebase/storage'
  import { getAnalytics, isSupported } from 'firebase/analytics'
+ import { getDatabase } from 'firebase/database'
  
  const firebaseConfig = {
      apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,
      authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,
+     databaseURL: process.env.NEXT_PUBLIC_FIREBASE_DATABASE_URL,
      projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,
      storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,
```

```diff
  const auth = getAuth(app)
  const storage = getStorage(app)
+ const database = getDatabase(app)
  let analytics
  
```

```diff
  }
  
- export { app, firestore, auth, storage, analytics }
+ export { app, firestore, auth, storage, database, analytics }
```

---

Now, let me create a comprehensive Firebase Realtime Database service module that follows the optimal data structure we designed earlier:

---

```diff
- 
+ 'use client'
+ 
+ import {
+     getDatabase,
+     ref,
+     push,
+     set,
+     get,
+     update,
+     remove,
+     onValue,
+     off,
+     serverTimestamp,
+     query,
+     orderByChild,
+     orderByKey,
+     limitToLast,
+     limitToFirst,
+     equalTo,
+     DatabaseReference,
+     DataSnapshot,
+     Unsubscribe
+ } from 'firebase/database'
+ import { getAuth } from 'firebase/auth'
+ import { database } from './firebase.config'
+ 
+ // Types for the Disney vacation planning app
+ export interface User {
+     profile: {
+         displayName: string
+         email: string
+         photoURL?: string
+         phoneNumber?: string
+         createdAt: number
+         lastActive: number
+     }
+     preferences: {
+         partySize: number
+         hasChildren: boolean
+         childrenAges?: number[]
+         mobilityConsiderations: boolean
+         ridePreference: 'thrill' | 'family' | 'all'
+         maxWaitTime: number
+         useGeniePlus: boolean
+         walkingPace: 'slow' | 'moderate' | 'fast'
+         notifications: {
+             waitTimes: boolean
+             groupMessages: boolean
+             emergencyAlerts: boolean
+         }
+     }
+     vacationIds: Record<string, boolean>
+     deviceTokens?: Record<string, {
+         token: string
+         platform: 'ios' | 'android' | 'web'
+         lastUpdated: number
+     }>
+ }
+ 
+ export interface Vacation {
+     basic: {
+         name: string
+         description?: string
+         destination: string
+         startDate: string
+         endDate: string
+         createdBy: string
+         createdAt: number
+         updatedAt: number
+         status: 'planning' | 'confirmed' | 'active' | 'completed'
+         imageUrl?: string
+         shareCode?: string
+     }
+     members: Record<string, {
+         role: 'owner' | 'editor' | 'viewer'
+         joinedAt: number
+         permissions: {
+             editItinerary: boolean
+             manageBudget: boolean
+             inviteOthers: boolean
+         }
+     }>
+     accommodation?: {
+         resortId: string
+         resortName: string
+         roomType: string
+         checkIn: string
+         checkOut: string
+         confirmationNumber: string
+     }
+     travelers: {
+         adults: number
+         children: number
+         childrenAges?: number[]
+     }
+ }
+ 
+ export interface GroupMessage {
+     userId: string
+     userName: string
+     userPhotoURL?: string
+     content: string
+     timestamp: number
+     type: 'text' | 'location' | 'photo' | 'poll'
+     reactions?: Record<string, string>
+     replyTo?: string
+     edited: boolean
+     editedAt?: number
+ }
+ 
+ export interface LocationUpdate {
+     userId: string
+     userName: string
+     userPhotoURL?: string
+     location: {
+         latitude: number
+         longitude: number
+         accuracy?: number
+         parkId?: string
+         areaId?: string
+         attractionId?: string
+         name: string
+     }
+     message?: string
+     timestamp: number
+     isEmergency: boolean
+ }
+ 
+ export interface WaitTimeData {
+     lastUpdated: number
+     attractions: Record<string, {
+         status: 'OPERATING' | 'DOWN' | 'CLOSED'
+         standbyWait: number
+         lightningLane?: {
+             available: boolean
+             nextReturnTime?: string
+             price?: number
+         }
+         lastUpdated: number
+     }>
+ }
+ 
+ // =============================================================================
+ // AUTHENTICATION & USER MANAGEMENT
+ // =============================================================================
+ 
+ /**
+  * Get the current authenticated user
+  */
+ export function getCurrentUser() {
+     const auth = getAuth()
+     return auth.currentUser
+ }
+ 
+ /**
+  * Create or update user profile in Realtime Database
+  */
+ export async function createUserProfile(userId: string, userData: Partial<User>): Promise<void> {
+     const userRef = ref(database, `users/${userId}`)
+     const currentTime = Date.now()
+ 
+     const defaultUserData: User = {
+         profile: {
+             displayName: userData.profile?.displayName || 'Anonymous User',
+             email: userData.profile?.email || '',
+             photoURL: userData.profile?.photoURL,
+             phoneNumber: userData.profile?.phoneNumber,
+             createdAt: currentTime,
+             lastActive: currentTime
+         },
+         preferences: {
+             partySize: 4,
+             hasChildren: false,
+             mobilityConsiderations: false,
+             ridePreference: 'family',
+             maxWaitTime: 60,
+             useGeniePlus: true,
+             walkingPace: 'moderate',
+             notifications: {
+                 waitTimes: true,
+                 groupMessages: true,
+                 emergencyAlerts: true
+             },
+             ...userData.preferences
+         },
+         vacationIds: userData.vacationIds || {}
+     }
+ 
+     await set(userRef, defaultUserData)
+ }
+ 
+ /**
+  * Update user's last active timestamp
+  */
+ export async function updateUserActivity(userId: string): Promise<void> {
+     const userRef = ref(database, `users/${userId}/profile/lastActive`)
+     await set(userRef, Date.now())
+ }
+ 
+ /**
+  * Get user data
+  */
+ export async function getUserData(userId: string): Promise<User | null> {
+     const userRef = ref(database, `users/${userId}`)
+     const snapshot = await get(userRef)
+     return snapshot.exists() ? snapshot.val() : null
+ }
+ 
+ // =============================================================================
+ // VACATION MANAGEMENT
+ // =============================================================================
+ 
+ /**
+  * Create a new vacation
+  */
+ export async function createVacation(vacationData: Omit<Vacation['basic'], 'createdAt' | 'updatedAt' | 'createdBy'>, userId: string): Promise<string> {
+     const vacationsRef = ref(database, 'vacations')
+     const newVacationRef = push(vacationsRef)
+     const vacationId = newVacationRef.key!
+ 
+     const currentTime = Date.now()
+     const vacation: Vacation = {
+         basic: {
+             ...vacationData,
+             createdBy: userId,
+             createdAt: currentTime,
+             updatedAt: currentTime
+         },
+         members: {
+             [userId]: {
+                 role: 'owner',
+                 joinedAt: currentTime,
+                 permissions: {
+                     editItinerary: true,
+                     manageBudget: true,
+                     inviteOthers: true
+                 }
+             }
+         },
+         travelers: vacationData.travelers || { adults: 2, children: 0 }
+     }
+ 
+     await set(newVacationRef, vacation)
+ 
+     // Add vacation to user's vacation list
+     const userVacationRef = ref(database, `users/${userId}/vacationIds/${vacationId}`)
+     await set(userVacationRef, true)
+ 
+     return vacationId
+ }
+ 
+ /**
+  * Get vacation data
+  */
+ export async function getVacation(vacationId: string): Promise<Vacation | null> {
+     const vacationRef = ref(database, `vacations/${vacationId}`)
+     const snapshot = await get(vacationRef)
+     return snapshot.exists() ? snapshot.val() : null
+ }
+ 
+ /**
+  * Update vacation data
+  */
+ export async function updateVacation(vacationId: string, updates: Partial<Vacation['basic']>): Promise<void> {
+     const vacationRef = ref(database, `vacations/${vacationId}/basic`)
+     await update(vacationRef, {
+         ...updates,
+         updatedAt: Date.now()
+     })
+ }
+ 
+ /**
+  * Add member to vacation
+  */
+ export async function addVacationMember(
+     vacationId: string,
+     userId: string,
+     role: 'editor' | 'viewer' = 'viewer'
+ ): Promise<void> {
+     const memberRef = ref(database, `vacations/${vacationId}/members/${userId}`)
+     const userVacationRef = ref(database, `users/${userId}/vacationIds/${vacationId}`)
+ 
+     const memberData = {
+         role,
+         joinedAt: Date.now(),
+         permissions: {
+             editItinerary: role === 'editor',
+             manageBudget: false,
+             inviteOthers: false
+         }
+     }
+ 
+     await Promise.all([
+         set(memberRef, memberData),
+         set(userVacationRef, true)
+     ])
+ }
+ 
+ // =============================================================================
+ // REAL-TIME MESSAGING
+ // =============================================================================
+ 
+ /**
+  * Send a message to the group
+  */
+ export async function sendGroupMessage(
+     vacationId: string,
+     userId: string,
+     userName: string,
+     content: string,
+     type: GroupMessage['type'] = 'text',
+     userPhotoURL?: string
+ ): Promise<string> {
+     const messagesRef = ref(database, `groupMessages/${vacationId}`)
+     const messageRef = push(messagesRef)
+ 
+     const message: GroupMessage = {
+         userId,
+         userName,
+         userPhotoURL,
+         content,
+         timestamp: Date.now(),
+         type,
+         edited: false
+     }
+ 
+     await set(messageRef, message)
+     return messageRef.key!
+ }
+ 
+ /**
+  * Listen to group messages
+  */
+ export function listenToGroupMessages(
+     vacationId: string,
+     callback: (messages: Record<string, GroupMessage>) => void,
+     limit: number = 50
+ ): Unsubscribe {
+     const messagesRef = query(
+         ref(database, `groupMessages/${vacationId}`),
+         orderByChild('timestamp'),
+         limitToLast(limit)
+     )
+ 
+     return onValue(messagesRef, (snapshot) => {
+         const messages = snapshot.exists() ? snapshot.val() : {}
+         callback(messages)
+     })
+ }
+ 
+ /**
+  * Add reaction to a message
+  */
+ export async function addMessageReaction(
+     vacationId: string,
+     messageId: string,
+     userId: string,
+     reaction: string
+ ): Promise<void> {
+     const reactionRef = ref(database, `groupMessages/${vacationId}/${messageId}/reactions/${userId}`)
+     await set(reactionRef, reaction)
+ }
+ 
+ // =============================================================================
+ // LOCATION SHARING
+ // =============================================================================
+ 
+ /**
+  * Update user's location sharing status
+  */
+ export async function updateLocationSharingStatus(
+     vacationId: string,
+     userId: string,
+     userName: string,
+     isSharing: boolean,
+     userPhotoURL?: string
+ ): Promise<void> {
+     const statusRef = ref(database, `groupLocations/${vacationId}/members/${userId}`)
+ 
+     const statusData = {
+         userName,
+         userPhotoURL,
+         isSharing,
+         lastUpdated: Date.now()
+     }
+ 
+     await set(statusRef, statusData)
+ }
+ 
+ /**
+  * Share location update
+  */
+ export async function shareLocationUpdate(
+     vacationId: string,
+     userId: string,
+     userName: string,
+     location: LocationUpdate['location'],
+     message?: string,
+     isEmergency: boolean = false,
+     userPhotoURL?: string
+ ): Promise<string> {
+     const updatesRef = ref(database, `groupLocations/${vacationId}/updates`)
+     const updateRef = push(updatesRef)
+ 
+     const locationUpdate: LocationUpdate = {
+         userId,
+         userName,
+         userPhotoURL,
+         location,
+         message,
+         timestamp: Date.now(),
+         isEmergency
+     }
+ 
+     await set(updateRef, locationUpdate)
+ 
+     // Also update the member's current location
+     const memberLocationRef = ref(database, `groupLocations/${vacationId}/members/${userId}/location`)
+     await set(memberLocationRef, location)
+ 
+     return updateRef.key!
+ }
+ 
+ /**
+  * Listen to location updates
+  */
+ export function listenToLocationUpdates(
+     vacationId: string,
+     callback: (updates: Record<string, LocationUpdate>) => void,
+     limit: number = 20
+ ): Unsubscribe {
+     const updatesRef = query(
+         ref(database, `groupLocations/${vacationId}/updates`),
+         orderByChild('timestamp'),
+         limitToLast(limit)
+     )
+ 
+     return onValue(updatesRef, (snapshot) => {
+         const updates = snapshot.exists() ? snapshot.val() : {}
+         callback(updates)
+     })
+ }
+ 
+ /**
+  * Listen to group member locations
+  */
+ export function listenToGroupMemberLocations(
+     vacationId: string,
+     callback: (members: Record<string, any>) => void
+ ): Unsubscribe {
+     const membersRef = ref(database, `groupLocations/${vacationId}/members`)
+ 
+     return onValue(membersRef, (snapshot) => {
+         const members = snapshot.exists() ? snapshot.val() : {}
+         callback(members)
+     })
+ }
+ 
+ // =============================================================================
+ // WAIT TIMES & PARK DATA
+ // =============================================================================
+ 
+ /**
+  * Update live wait times for a park
+  */
+ export async function updateParkWaitTimes(parkId: string, waitTimeData: WaitTimeData): Promise<void> {
+     const waitTimesRef = ref(database, `liveWaitTimes/${parkId}`)
+     await set(waitTimesRef, waitTimeData)
+ }
+ 
+ /**
+  * Get current wait times for a park
+  */
+ export async function getParkWaitTimes(parkId: string): Promise<WaitTimeData | null> {
+     const waitTimesRef = ref(database, `liveWaitTimes/${parkId}`)
+     const snapshot = await get(waitTimesRef)
+     return snapshot.exists() ? snapshot.val() : null
+ }
+ 
+ /**
+  * Listen to wait time updates for a park
+  */
+ export function listenToParkWaitTimes(
+     parkId: string,
+     callback: (waitTimes: WaitTimeData) => void
+ ): Unsubscribe {
+     const waitTimesRef = ref(database, `liveWaitTimes/${parkId}`)
+ 
+     return onValue(waitTimesRef, (snapshot) => {
+         if (snapshot.exists()) {
+             callback(snapshot.val())
+         }
+     })
+ }
+ 
+ // =============================================================================
+ // NOTIFICATIONS & ALERTS
+ // =============================================================================
+ 
+ /**
+  * Send notification to user
+  */
+ export async function sendNotification(
+     userId: string,
+     type: string,
+     title: string,
+     message: string,
+     data: Record<string, any> = {},
+     vacationId?: string
+ ): Promise<string> {
+     const notificationsRef = ref(database, `notifications/${userId}`)
+     const notificationRef = push(notificationsRef)
+ 
+     const notification = {
+         type,
+         title,
+         message,
+         data,
+         timestamp: Date.now(),
+         read: false,
+         vacationId
+     }
+ 
+     await set(notificationRef, notification)
+     return notificationRef.key!
+ }
+ 
+ /**
+  * Listen to user notifications
+  */
+ export function listenToNotifications(
+     userId: string,
+     callback: (notifications: Record<string, any>) => void
+ ): Unsubscribe {
+     const notificationsRef = query(
+         ref(database, `notifications/${userId}`),
+         orderByChild('timestamp'),
+         limitToLast(20)
+     )
+ 
+     return onValue(notificationsRef, (snapshot) => {
+         const notifications = snapshot.exists() ? snapshot.val() : {}
+         callback(notifications)
+     })
+ }
+ 
+ /**
+  * Mark notification as read
+  */
+ export async function markNotificationAsRead(userId: string, notificationId: string): Promise<void> {
+     const notificationRef = ref(database, `notifications/${userId}/${notificationId}/read`)
+     await set(notificationRef, true)
+ }
+ 
+ // =============================================================================
+ // UTILITY FUNCTIONS
+ // =============================================================================
+ 
+ /**
+  * Remove all listeners for a reference
+  */
+ export function removeListener(dbRef: DatabaseReference): void {
+     off(dbRef)
+ }
+ 
+ /**
+  * Get server timestamp
+  */
+ export function getServerTimestamp() {
+     return serverTimestamp()
+ }
+ 
+ /**
+  * Generate a unique push ID
+  */
+ export function generatePushId(): string {
+     const pushRef = push(ref(database, 'temp'))
+     return pushRef.key!
+ }
+ 
+ // =============================================================================
+ // BATCH OPERATIONS
+ // =============================================================================
+ 
+ /**
+  * Update multiple paths atomically
+  */
+ export async function updateMultiplePaths(updates: Record<string, any>): Promise<void> {
+     const rootRef = ref(database)
+     await update(rootRef, updates)
+ }
+ 
+ /**
+  * Remove data at path
+  */
+ export async function removeData(path: string): Promise<void> {
+     const dataRef = ref(database, path)
+     await remove(dataRef)
+ }
+ 
+ // Export the database instance for direct use if needed
+ export { database }
```

---

Now let me create a React hook for easier integration with your existing components:

---

```diff
- 
+ 'use client'
+ 
+ import { useState, useEffect, useCallback, useRef } from 'react'
+ import {
+     listenToGroupMessages,
+     listenToLocationUpdates,
+     listenToGroupMemberLocations,
+     listenToParkWaitTimes,
+     listenToNotifications,
+     sendGroupMessage,
+     shareLocationUpdate,
+     updateLocationSharingStatus,
+     addMessageReaction,
+     markNotificationAsRead,
+     getCurrentUser,
+     type GroupMessage,
+     type LocationUpdate,
+     type WaitTimeData,
+     type Unsubscribe
+ } from '@/lib/firebase/realtime-database'
+ 
+ // =============================================================================
+ // GROUP MESSAGING HOOK
+ // =============================================================================
+ 
+ export function useGroupMessages(vacationId: string, limit: number = 50) {
+     const [messages, setMessages] = useState<Record<string, GroupMessage>>({})
+     const [loading, setLoading] = useState(true)
+     const [error, setError] = useState<string | null>(null)
+     const unsubscribeRef = useRef<Unsubscribe | null>(null)
+ 
+     useEffect(() => {
+         if (!vacationId) return
+ 
+         setLoading(true)
+         setError(null)
+ 
+         try {
+             unsubscribeRef.current = listenToGroupMessages(
+                 vacationId,
+                 (newMessages) => {
+                     setMessages(newMessages)
+                     setLoading(false)
+                 },
+                 limit
+             )
+         } catch (err) {
+             setError(err instanceof Error ? err.message : 'Failed to listen to messages')
+             setLoading(false)
+         }
+ 
+         return () => {
+             if (unsubscribeRef.current) {
+                 unsubscribeRef.current()
+                 unsubscribeRef.current = null
+             }
+         }
+     }, [vacationId, limit])
+ 
+     const sendMessage = useCallback(async (content: string, type: GroupMessage['type'] = 'text') => {
+         const user = getCurrentUser()
+         if (!user || !vacationId) {
+             throw new Error('User not authenticated or vacation ID missing')
+         }
+ 
+         try {
+             await sendGroupMessage(
+                 vacationId,
+                 user.uid,
+                 user.displayName || 'Anonymous User',
+                 content,
+                 type,
+                 user.photoURL || undefined
+             )
+         } catch (err) {
+             throw new Error(err instanceof Error ? err.message : 'Failed to send message')
+         }
+     }, [vacationId])
+ 
+     const addReaction = useCallback(async (messageId: string, reaction: string) => {
+         const user = getCurrentUser()
+         if (!user || !vacationId) {
+             throw new Error('User not authenticated or vacation ID missing')
+         }
+ 
+         try {
+             await addMessageReaction(vacationId, messageId, user.uid, reaction)
+         } catch (err) {
+             throw new Error(err instanceof Error ? err.message : 'Failed to add reaction')
+         }
+     }, [vacationId])
+ 
+     return {
+         messages,
+         loading,
+         error,
+         sendMessage,
+         addReaction
+     }
+ }
+ 
+ // =============================================================================
+ // LOCATION SHARING HOOK
+ // =============================================================================
+ 
+ export function useLocationSharing(vacationId: string) {
+     const [memberLocations, setMemberLocations] = useState<Record<string, any>>({})
+     const [locationUpdates, setLocationUpdates] = useState<Record<string, LocationUpdate>>({})
+     const [loading, setLoading] = useState(true)
+     const [error, setError] = useState<string | null>(null)
+     const [isSharing, setIsSharing] = useState(false)
+ 
+     const membersUnsubscribeRef = useRef<Unsubscribe | null>(null)
+     const updatesUnsubscribeRef = useRef<Unsubscribe | null>(null)
+ 
+     useEffect(() => {
+         if (!vacationId) return
+ 
+         setLoading(true)
+         setError(null)
+ 
+         try {
+             // Listen to member locations
+             membersUnsubscribeRef.current = listenToGroupMemberLocations(
+                 vacationId,
+                 (members) => {
+                     setMemberLocations(members)
+                     setLoading(false)
+                 }
+             )
+ 
+             // Listen to location updates
+             updatesUnsubscribeRef.current = listenToLocationUpdates(
+                 vacationId,
+                 (updates) => {
+                     setLocationUpdates(updates)
+                 }
+             )
+         } catch (err) {
+             setError(err instanceof Error ? err.message : 'Failed to listen to location updates')
+             setLoading(false)
+         }
+ 
+         return () => {
+             if (membersUnsubscribeRef.current) {
+                 membersUnsubscribeRef.current()
+                 membersUnsubscribeRef.current = null
+             }
+             if (updatesUnsubscribeRef.current) {
+                 updatesUnsubscribeRef.current()
+                 updatesUnsubscribeRef.current = null
+             }
+         }
+     }, [vacationId])
+ 
+     const toggleLocationSharing = useCallback(async (enable: boolean) => {
+         const user = getCurrentUser()
+         if (!user || !vacationId) {
+             throw new Error('User not authenticated or vacation ID missing')
+         }
+ 
+         try {
+             await updateLocationSharingStatus(
+                 vacationId,
+                 user.uid,
+                 user.displayName || 'Anonymous User',
+                 enable,
+                 user.photoURL || undefined
+             )
+             setIsSharing(enable)
+         } catch (err) {
+             throw new Error(err instanceof Error ? err.message : 'Failed to update location sharing')
+         }
+     }, [vacationId])
+ 
+     const shareLocation = useCallback(async (
+         location: LocationUpdate['location'],
+         message?: string,
+         isEmergency: boolean = false
+     ) => {
+         const user = getCurrentUser()
+         if (!user || !vacationId) {
+             throw new Error('User not authenticated or vacation ID missing')
+         }
+ 
+         try {
+             await shareLocationUpdate(
+                 vacationId,
+                 user.uid,
+                 user.displayName || 'Anonymous User',
+                 location,
+                 message,
+                 isEmergency,
+                 user.photoURL || undefined
+             )
+         } catch (err) {
+             throw new Error(err instanceof Error ? err.message : 'Failed to share location')
+         }
+     }, [vacationId])
+ 
+     return {
+         memberLocations,
+         locationUpdates,
+         loading,
+         error,
+         isSharing,
+         toggleLocationSharing,
+         shareLocation
+     }
+ }
+ 
+ // =============================================================================
+ // WAIT TIMES HOOK
+ // =============================================================================
+ 
+ export function useWaitTimes(parkId: string) {
+     const [waitTimes, setWaitTimes] = useState<WaitTimeData | null>(null)
+     const [loading, setLoading] = useState(true)
+     const [error, setError] = useState<string | null>(null)
+     const [lastUpdated, setLastUpdated] = useState<Date | null>(null)
+ 
+     const unsubscribeRef = useRef<Unsubscribe | null>(null)
+ 
+     useEffect(() => {
+         if (!parkId) return
+ 
+         setLoading(true)
+         setError(null)
+ 
+         try {
+             unsubscribeRef.current = listenToParkWaitTimes(
+                 parkId,
+                 (newWaitTimes) => {
+                     setWaitTimes(newWaitTimes)
+                     setLastUpdated(new Date(newWaitTimes.lastUpdated))
+                     setLoading(false)
+                 }
+             )
+         } catch (err) {
+             setError(err instanceof Error ? err.message : 'Failed to listen to wait times')
+             setLoading(false)
+         }
+ 
+         return () => {
+             if (unsubscribeRef.current) {
+                 unsubscribeRef.current()
+                 unsubscribeRef.current = null
+             }
+         }
+     }, [parkId])
+ 
+     // Helper function to get wait time for specific attraction
+     const getAttractionWaitTime = useCallback((attractionId: string) => {
+         return waitTimes?.attractions[attractionId] || null
+     }, [waitTimes])
+ 
+     // Helper function to get operating attractions
+     const getOperatingAttractions = useCallback(() => {
+         if (!waitTimes) return []
+ 
+         return Object.entries(waitTimes.attractions)
+             .filter(([_, attraction]) => attraction.status === 'OPERATING')
+             .map(([id, attraction]) => ({ id, ...attraction }))
+             .sort((a, b) => a.standbyWait - b.standbyWait)
+     }, [waitTimes])
+ 
+     return {
+         waitTimes,
+         loading,
+         error,
+         lastUpdated,
+         getAttractionWaitTime,
+         getOperatingAttractions
+     }
+ }
+ 
+ // =============================================================================
+ // NOTIFICATIONS HOOK
+ // =============================================================================
+ 
+ export function useNotifications(userId?: string) {
+     const [notifications, setNotifications] = useState<Record<string, any>>({})
+     const [loading, setLoading] = useState(true)
+     const [error, setError] = useState<string | null>(null)
+     const [unreadCount, setUnreadCount] = useState(0)
+ 
+     const unsubscribeRef = useRef<Unsubscribe | null>(null)
+ 
+     useEffect(() => {
+         const user = getCurrentUser()
+         const targetUserId = userId || user?.uid
+ 
+         if (!targetUserId) {
+             setLoading(false)
+             return
+         }
+ 
+         setLoading(true)
+         setError(null)
+ 
+         try {
+             unsubscribeRef.current = listenToNotifications(
+                 targetUserId,
+                 (newNotifications) => {
+                     setNotifications(newNotifications)
+ 
+                     // Count unread notifications
+                     const unread = Object.values(newNotifications).filter(
+                         (notification: any) => !notification.read
+                     ).length
+                     setUnreadCount(unread)
+ 
+                     setLoading(false)
+                 }
+             )
+         } catch (err) {
+             setError(err instanceof Error ? err.message : 'Failed to listen to notifications')
+             setLoading(false)
+         }
+ 
+         return () => {
+             if (unsubscribeRef.current) {
+                 unsubscribeRef.current()
+                 unsubscribeRef.current = null
+             }
+         }
+     }, [userId])
+ 
+     const markAsRead = useCallback(async (notificationId: string) => {
+         const user = getCurrentUser()
+         const targetUserId = userId || user?.uid
+ 
+         if (!targetUserId) {
+             throw new Error('User not authenticated')
+         }
+ 
+         try {
+             await markNotificationAsRead(targetUserId, notificationId)
+         } catch (err) {
+             throw new Error(err instanceof Error ? err.message : 'Failed to mark notification as read')
+         }
+     }, [userId])
+ 
+     return {
+         notifications,
+         loading,
+         error,
+         unreadCount,
+         markAsRead
+     }
+ }
+ 
+ // =============================================================================
+ // COMBINED VACATION HOOK
+ // =============================================================================
+ 
+ export function useVacationRealtime(vacationId: string, parkId?: string) {
+     const messages = useGroupMessages(vacationId)
+     const locationSharing = useLocationSharing(vacationId)
+     const waitTimes = parkId ? useWaitTimes(parkId) : null
+     const user = getCurrentUser()
+     const notifications = useNotifications(user?.uid)
+ 
+     const isLoading = messages.loading || locationSharing.loading || (waitTimes?.loading ?? false) || notifications.loading
+     const hasError = messages.error || locationSharing.error || waitTimes?.error || notifications.error
+ 
+     return {
+         messages,
+         locationSharing,
+         waitTimes,
+         notifications,
+         isLoading,
+         hasError,
+         user
+     }
+ }
+ 
+ export default useVacationRealtime
```

---

Now let me create an environment variable example file with the required Firebase Realtime Database URL:

---

Cannot edit files blocked by globalIgnore

---

Let me update your existing group components to use the new Realtime Database hooks:

---

```diff
- 
+ 'use client'
+ 
+ import { useState, useRef, useEffect } from 'react'
+ import { Button } from '@/components/ui/button'
+ import { Input } from '@/components/ui/input'
+ import { Card, CardContent, CardFooter, CardHeader, CardTitle } from '@/components/ui/card'
+ import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'
+ import { Badge } from '@/components/ui/badge'
+ import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip'
+ import { ScrollArea } from '@/components/ui/scroll-area'
+ import { useGroupMessages } from '@/hooks/useRealtimeDatabase'
+ import { Send, Smile, MapPin, Camera, Users } from 'lucide-react'
+ import { formatDistanceToNow } from 'date-fns'
+ import { toast } from 'sonner'
+ 
+ interface GroupChatProps {
+     vacationId: string
+     className?: string
+ }
+ 
+ const EMOJI_REACTIONS = ['👍', '❤️', '😂', '😮', '😢', '😡']
+ 
+ export default function GroupChat({ vacationId, className }: GroupChatProps) {
+     const [messageInput, setMessageInput] = useState('')
+     const [isTyping, setIsTyping] = useState(false)
+     const messagesEndRef = useRef<HTMLDivElement>(null)
+ 
+     const {
+         messages,
+         loading,
+         error,
+         sendMessage,
+         addReaction
+     } = useGroupMessages(vacationId)
+ 
+     // Auto-scroll to bottom when new messages arrive
+     useEffect(() => {
+         messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })
+     }, [messages])
+ 
+     const handleSendMessage = async () => {
+         if (!messageInput.trim()) return
+ 
+         try {
+             setIsTyping(true)
+             await sendMessage(messageInput.trim())
+             setMessageInput('')
+             toast.success('Message sent!')
+         } catch (err) {
+             toast.error(err instanceof Error ? err.message : 'Failed to send message')
+         } finally {
+             setIsTyping(false)
+         }
+     }
+ 
+     const handleKeyPress = (e: React.KeyboardEvent) => {
+         if (e.key === 'Enter' && !e.shiftKey) {
+             e.preventDefault()
+             handleSendMessage()
+         }
+     }
+ 
+     const handleAddReaction = async (messageId: string, reaction: string) => {
+         try {
+             await addReaction(messageId, reaction)
+         } catch (err) {
+             toast.error('Failed to add reaction')
+         }
+     }
+ 
+     const sortedMessages = Object.entries(messages || {})
+         .sort(([, a], [, b]) => a.timestamp - b.timestamp)
+ 
+     const getInitials = (name: string) => {
+         return name.split(' ').map(word => word[0]).join('').toUpperCase().slice(0, 2)
+     }
+ 
+     if (loading) {
+         return (
+             <Card className={className}>
+                 <CardContent className="flex items-center justify-center h-96">
+                     <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
+                 </CardContent>
+             </Card>
+         )
+     }
+ 
+     if (error) {
+         return (
+             <Card className={className}>
+                 <CardContent className="flex items-center justify-center h-96">
+                     <p className="text-destructive">Error loading chat: {error}</p>
+                 </CardContent>
+             </Card>
+         )
+     }
+ 
+     return (
+         <Card className={className}>
+             <CardHeader className="pb-3">
+                 <CardTitle className="flex items-center gap-2">
+                     <Users className="h-5 w-5" />
+                     Group Chat
+                     <Badge variant="secondary" className="ml-auto">
+                         {sortedMessages.length} messages
+                     </Badge>
+                 </CardTitle>
+             </CardHeader>
+ 
+             <CardContent className="p-0">
+                 <ScrollArea className="h-96 px-4">
+                     <div className="space-y-4">
+                         {sortedMessages.length === 0 ? (
+                             <div className="text-center py-8 text-muted-foreground">
+                                 <Users className="h-12 w-12 mx-auto mb-4 opacity-50" />
+                                 <p>No messages yet. Start the conversation!</p>
+                             </div>
+                         ) : (
+                             sortedMessages.map(([messageId, message]) => (
+                                 <div key={messageId} className="flex gap-3">
+                                     <Avatar className="h-8 w-8">
+                                         <AvatarImage src={message.userPhotoURL} />
+                                         <AvatarFallback className="text-xs">
+                                             {getInitials(message.userName)}
+                                         </AvatarFallback>
+                                     </Avatar>
+ 
+                                     <div className="flex-1 min-w-0">
+                                         <div className="flex items-center gap-2 mb-1">
+                                             <p className="text-sm font-medium">{message.userName}</p>
+                                             <p className="text-xs text-muted-foreground">
+                                                 {formatDistanceToNow(new Date(message.timestamp), { addSuffix: true })}
+                                             </p>
+                                             {message.edited && (
+                                                 <Badge variant="outline" className="text-xs">
+                                                     edited
+                                                 </Badge>
+                                             )}
+                                         </div>
+ 
+                                         <div className="bg-muted rounded-lg px-3 py-2 mb-2">
+                                             {message.type === 'location' ? (
+                                                 <div className="flex items-center gap-2 text-sm">
+                                                     <MapPin className="h-4 w-4 text-primary" />
+                                                     Shared location: {message.content}
+                                                 </div>
+                                             ) : message.type === 'photo' ? (
+                                                 <div className="flex items-center gap-2 text-sm">
+                                                     <Camera className="h-4 w-4 text-primary" />
+                                                     Shared a photo
+                                                 </div>
+                                             ) : (
+                                                 <p className="text-sm whitespace-pre-wrap">{message.content}</p>
+                                             )}
+                                         </div>
+ 
+                                         {/* Reactions */}
+                                         <div className="flex items-center gap-2">
+                                             <div className="flex gap-1">
+                                                 {Object.entries(message.reactions || {}).map(([userId, reaction]) => (
+                                                     <Badge key={userId} variant="outline" className="text-xs px-1">
+                                                         {reaction}
+                                                     </Badge>
+                                                 ))}
+                                             </div>
+ 
+                                             {/* Add reaction dropdown */}
+                                             <TooltipProvider>
+                                                 <div className="flex gap-1">
+                                                     {EMOJI_REACTIONS.map((emoji) => (
+                                                         <Tooltip key={emoji}>
+                                                             <TooltipTrigger asChild>
+                                                                 <Button
+                                                                     variant="ghost"
+                                                                     size="sm"
+                                                                     className="h-6 w-6 p-0 hover:bg-secondary"
+                                                                     onClick={() => handleAddReaction(messageId, emoji)}
+                                                                 >
+                                                                     {emoji}
+                                                                 </Button>
+                                                             </TooltipTrigger>
+                                                             <TooltipContent>
+                                                                 <p>React with {emoji}</p>
+                                                             </TooltipContent>
+                                                         </Tooltip>
+                                                     ))}
+                                                 </div>
+                                             </TooltipProvider>
+                                         </div>
+                                     </div>
+                                 </div>
+                             ))
+                         )}
+                         <div ref={messagesEndRef} />
+                     </div>
+                 </ScrollArea>
+             </CardContent>
+ 
+             <CardFooter className="pt-4">
+                 <div className="flex w-full gap-2">
+                     <Input
+                         placeholder="Type a message..."
+                         value={messageInput}
+                         onChange={(e) => setMessageInput(e.target.value)}
+                         onKeyPress={handleKeyPress}
+                         disabled={isTyping}
+                         className="flex-1"
+                     />
+                     <Button
+                         onClick={handleSendMessage}
+                         disabled={!messageInput.trim() || isTyping}
+                         size="sm"
+                     >
+                         {isTyping ? (
+                             <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
+                         ) : (
+                             <Send className="h-4 w-4" />
+                         )}
+                     </Button>
+                 </div>
+             </CardFooter>
+         </Card>
+     )
+ }
```

---

Now let me create a location sharing component:

---

```diff
  'use client'
  
- import { useState, useEffect, useCallback } from 'react'
- import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
- import { useAuth } from '@/contexts/AuthContext'
- import {
-     Card,
-     CardContent,
-     CardDescription,
-     CardFooter,
-     CardHeader,
-     CardTitle,
- } from "@/components/ui/card"
- import { Button } from "@/components/ui/button"
- import { Switch } from "@/components/ui/switch"
- import { Badge } from "@/components/ui/badge"
- import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
- import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from "@/components/ui/tooltip"
- import { Alert, AlertDescription, AlertTitle } from "@/components/ui/alert"
- import { ScrollArea } from "@/components/ui/scroll-area"
- import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
- import { toast } from "sonner"
+ import { useState, useEffect } from 'react'
+ import { Button } from '@/components/ui/button'
+ import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
+ import { Switch } from '@/components/ui/switch'
+ import { Badge } from '@/components/ui/badge'
+ import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'
+ import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert'
+ import { useLocationSharing } from '@/hooks/useRealtimeDatabase'
  import {
      MapPin,
      Users,
-     Share,
+     Navigation,
+     AlertTriangle,
      Clock,
-     RefreshCw,
-     Eye,
-     EyeOff,
-     Info,
-     Map as MapIcon,
-     AlertCircle,
- } from "lucide-react"
- import { motion } from 'framer-motion'
- import { format, formatDistanceToNow } from 'date-fns'
- import { doc, collection, getDoc, setDoc, updateDoc, onSnapshot, query, orderBy, serverTimestamp, limit, addDoc, getDocs, DocumentData, QueryDocumentSnapshot } from 'firebase/firestore'
- import { firestore } from '@/lib/firebase/firebase.config'
- import { cn } from '@/lib/utils'
- import { Input } from '@/components/ui/input'
- import { InteractiveMap, GroupMember } from '@/components/maps/interactive-map'
- 
- // Types
- interface LocationUpdate {
-     id: string
-     userId: string
-     userName: string
-     userPhotoURL?: string
-     location: {
-         name: string
-         latitude: number
-         longitude: number
-         parkId?: string
-         attractionId?: string
-         accuracy?: number
-     }
-     timestamp: Date
-     message?: string
- }
- 
- interface UserLocationStatus {
-     userId: string
-     userName: string
-     userPhotoURL?: string
-     isSharing: boolean
-     lastUpdated?: Date
-     lastLocation?: {
-         name: string
-         latitude: number
-         longitude: number
-         parkId?: string
-         attractionId?: string
-     }
- }
+     Locate
+ } from 'lucide-react'
+ import { formatDistanceToNow } from 'date-fns'
+ import { toast } from 'sonner'
  
  interface LocationSharingProps {
-     readonly vacationId: string
- }
- 
- // Helper functions to reduce nesting
- const mapDocToLocationUpdate = (doc: QueryDocumentSnapshot<DocumentData>): LocationUpdate => {
-     const data = doc.data()
-     return {
-         id: doc.id,
-         userId: data.userId,
-         userName: data.userName,
-         userPhotoURL: data.userPhotoURL,
-         location: data.location,
-         timestamp: data.timestamp?.toDate() || new Date(),
-         message: data.message
-     }
- }
- 
- const mapDocToLocationStatus = (doc: QueryDocumentSnapshot<DocumentData>): UserLocationStatus => {
-     const data = doc.data()
-     return {
-         userId: doc.id,
-         userName: data.userName,
-         userPhotoURL: data.userPhotoURL,
-         isSharing: data.isSharing,
-         lastUpdated: data.lastUpdated?.toDate(),
-         lastLocation: data.lastLocation
-     }
- }
- 
- // Format location statuses to GroupMember format for interactive map
- const formatGroupMembersForMap = (statuses: UserLocationStatus[] = []): GroupMember[] => {
-     return statuses
-         .filter(status => status.isSharing && status.lastLocation)
-         .map(status => ({
-             id: status.userId,
-             name: status.userName,
-             avatar: status.userPhotoURL,
-             lat: status.lastLocation?.latitude || 0,
-             lng: status.lastLocation?.longitude || 0,
-             lastUpdated: status.lastUpdated || new Date()
-         }));
- };
- 
- export default function LocationSharing({ vacationId }: LocationSharingProps) {
-     const { user } = useAuth()
-     const queryClient = useQueryClient()
-     const [isLocationSharingEnabled, setIsLocationSharingEnabled] = useState(false)
-     const [currentLocation, setCurrentLocation] = useState<GeolocationPosition | null>(null)
+     vacationId: string
+     className?: string
+ }
+ 
+ export default function LocationSharing({ vacationId, className }: LocationSharingProps) {
+     const [currentPosition, setCurrentPosition] = useState<GeolocationPosition | null>(null)
+     const [gettingLocation, setGettingLocation] = useState(false)
      const [locationError, setLocationError] = useState<string | null>(null)
-     const [locationName, setLocationName] = useState<string>('')
-     const [isManualUpdate, setIsManualUpdate] = useState(false)
-     const [isAutoUpdateActive, setIsAutoUpdateActive] = useState(false)
-     const [locationUpdateInterval, setLocationUpdateInterval] = useState<NodeJS.Timeout | null>(null)
- 
-     // Query for party members' location sharing status
-     const { data: locationStatuses, isLoading: isStatusesLoading } = useQuery({
-         queryKey: ['locationSharingStatuses', vacationId],
-         queryFn: async () => {
-             const statusesRef = collection(firestore, 'vacations', vacationId, 'locationSharing')
-             const q = query(statusesRef)
-             const snapshot = await getDocs(q)
- 
-             return snapshot.docs.map(mapDocToLocationStatus)
-         },
-         enabled: !!vacationId
-     })
- 
-     // Query for real-time location updates
-     const { data: locationUpdates } = useQuery({
-         queryKey: ['locationUpdates', vacationId],
-         queryFn: () => {
-             return new Promise<LocationUpdate[]>((resolve) => {
-                 const updatesRef = collection(firestore, 'vacations', vacationId, 'locationUpdates')
-                 const q = query(updatesRef, orderBy('timestamp', 'desc'), limit(50))
- 
-                 const unsubscribe = onSnapshot(q, (snapshot) => {
-                     const updates = snapshot.docs.map(mapDocToLocationUpdate)
-                     resolve(updates)
-                 })
- 
-                 // Cleanup function
-                 return () => unsubscribe()
-             })
-         },
-         enabled: !!vacationId,
-         staleTime: Infinity, // Real-time data is managed via onSnapshot
-     })
- 
-     // Current user's sharing status
-     const currentUserStatus = locationStatuses?.find(status => status.userId === user?.uid) || null
- 
-     // Active sharers (currently sharing their location)
-     const activeSharings = locationStatuses?.filter(status => status.isSharing) || []
- 
-     // Set or update user location sharing status
-     const updateSharingStatusMutation = useMutation({
-         mutationFn: async (isSharing: boolean) => {
-             if (!user) throw new Error('User not authenticated')
- 
-             const statusRef = doc(firestore, 'vacations', vacationId, 'locationSharing', user.uid)
-             const statusDoc = await getDoc(statusRef)
- 
-             if (!statusDoc.exists()) {
-                 // Create new status
-                 await setDoc(statusRef, {
-                     userName: user.displayName || 'Anonymous',
-                     userPhotoURL: user.photoURL,
+ 
+     const {
+         memberLocations,
+         locationUpdates,
+         loading,
+         error,
          isSharing,
-                     lastUpdated: serverTimestamp()
-                 })
-             } else {
-                 // Update existing status
-                 await updateDoc(statusRef, {
-                     isSharing,
-                     lastUpdated: serverTimestamp()
-                 })
-             }
- 
-             return isSharing
-         },
-         onSuccess: (isSharing) => {
-             setIsLocationSharingEnabled(isSharing)
- 
-             // Start or stop location updates based on sharing status
-             if (isSharing) {
-                 startLocationUpdates()
-                 toast("Location sharing enabled", {
-                     description: "Your party members can now see your location"
-                 })
-             } else {
-                 stopLocationUpdates()
-                 toast("Location sharing disabled", {
-                     description: "Your location is no longer being shared"
-                 })
-             }
- 
-             queryClient.invalidateQueries({ queryKey: ['locationSharingStatuses', vacationId] })
-         },
-         onError: (error) => {
-             toast.error("Error updating sharing status", {
-                 description: error instanceof Error ? error.message : "Unknown error occurred"
-             })
-         }
-     })
- 
-     // Share location update mutation
-     const shareLocationMutation = useMutation({
-         mutationFn: async ({
-             location,
-             name,
-             message
-         }: {
-             location: GeolocationPosition,
-             name?: string,
-             message?: string
-         }) => {
-             if (!user) throw new Error('User not authenticated')
- 
-             const updatesRef = collection(firestore, 'vacations', vacationId, 'locationUpdates')
- 
-             // Create location update
-             const updateData = {
-                 userId: user.uid,
-                 userName: user.displayName || 'Anonymous',
-                 userPhotoURL: user.photoURL,
-                 location: {
-                     latitude: location.coords.latitude,
-                     longitude: location.coords.longitude,
-                     accuracy: location.coords.accuracy,
-                     name: name || 'Current Location'
-                 },
-                 timestamp: serverTimestamp(),
-                 message
-             }
- 
-             const docRef = await addDoc(updatesRef, updateData)
- 
-             // Also update the user's current location in their status
-             const statusRef = doc(firestore, 'vacations', vacationId, 'locationSharing', user.uid)
-             await updateDoc(statusRef, {
-                 lastUpdated: serverTimestamp(),
-                 lastLocation: {
-                     latitude: location.coords.latitude,
-                     longitude: location.coords.longitude,
-                     name: name || 'Current Location'
-                 }
-             })
- 
-             return { id: docRef.id, ...updateData }
-         },
-         onSuccess: () => {
-             if (isManualUpdate) {
-                 toast("Location shared", {
-                     description: "Your location has been shared with your party"
-                 })
-                 setIsManualUpdate(false)
-                 setLocationName('')
-             }
- 
-             queryClient.invalidateQueries({ queryKey: ['locationSharingStatuses', vacationId] })
-         },
-         onError: (error) => {
-             toast.error("Error sharing location", {
-                 description: error instanceof Error ? error.message : "Unknown error occurred"
-             })
-         }
-     })
- 
-     // Get current location
-     const getCurrentLocation = useCallback(() => {
+         toggleLocationSharing,
+         shareLocation
+     } = useLocationSharing(vacationId)
+ 
+     // Get current position when location sharing is enabled
+     useEffect(() => {
+         if (isSharing && !currentPosition) {
+             getCurrentLocation()
+         }
+     }, [isSharing])
+ 
+     const getCurrentLocation = async () => {
          if (!navigator.geolocation) {
-             setLocationError('Geolocation is not supported by your browser')
+             setLocationError('Geolocation is not supported by this browser')
              return
          }
  
+         setGettingLocation(true)
          setLocationError(null)
  
          navigator.geolocation.getCurrentPosition(
              (position) => {
-                 setCurrentLocation(position)
-                 setLocationError(null)
+                 setCurrentPosition(position)
+                 setGettingLocation(false)
  
-                 // If this is an auto-update and sharing is enabled, share the location
-                 if (isLocationSharingEnabled && !isManualUpdate) {
-                     shareLocationMutation.mutate({
-                         location: position,
-                         name: 'Current Location',
-                     })
+                 // Auto-share location when enabled
+                 if (isSharing) {
+                     shareCurrentLocation(position)
                  }
              },
              (error) => {
+                 setLocationError(getLocationErrorMessage(error))
+                 setGettingLocation(false)
+             },
+             {
+                 enableHighAccuracy: true,
+                 timeout: 10000,
+                 maximumAge: 60000 // Cache location for 1 minute
+             }
+         )
+     }
+ 
+     const getLocationErrorMessage = (error: GeolocationPositionError): string => {
          switch (error.code) {
              case error.PERMISSION_DENIED:
-                         setLocationError('Location permission denied')
-                         break
+                 return 'Location access denied. Please enable location permissions.'
              case error.POSITION_UNAVAILABLE:
-                         setLocationError('Location information is unavailable')
-                         break
+                 return 'Location information is unavailable.'
              case error.TIMEOUT:
-                         setLocationError('Location request timed out')
-                         break
+                 return 'Location request timed out.'
              default:
-                         setLocationError('An unknown error occurred')
-                         break
-                 }
-             },
-             { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
-         )
-     }, [isLocationSharingEnabled, isManualUpdate, shareLocationMutation])
- 
-     // Initialize state based on current user's status
-     useEffect(() => {
-         if (currentUserStatus) {
-             setIsLocationSharingEnabled(currentUserStatus.isSharing)
- 
-             // If sharing is enabled, start location updates
-             if (currentUserStatus.isSharing && !isAutoUpdateActive) {
-                 // This avoids the dependency on startLocationUpdates
-                 getCurrentLocation()
- 
-                 if (!isAutoUpdateActive) {
-                     const interval = setInterval(() => {
-                         getCurrentLocation()
-                     }, 5 * 60 * 1000) // 5 minutes
- 
-                     setLocationUpdateInterval(interval)
-                     setIsAutoUpdateActive(true)
-                 }
-             }
-         }
-     }, [currentUserStatus, isAutoUpdateActive, getCurrentLocation])
- 
-     // Clean up interval on unmount
-     useEffect(() => {
-         return () => {
-             if (locationUpdateInterval) {
-                 clearInterval(locationUpdateInterval)
+                 return 'An unknown error occurred while getting location.'
+         }
+     }
+ 
+     const shareCurrentLocation = async (position: GeolocationPosition) => {
+         try {
+             await shareLocation({
+                 latitude: position.coords.latitude,
+                 longitude: position.coords.longitude,
+                 accuracy: position.coords.accuracy,
+                 name: 'Current Location'
+             })
+         } catch (err) {
+             toast.error('Failed to share location')
          }
      }
-     }, [locationUpdateInterval])
- 
-     // Start automatic location updates
-     const startLocationUpdates = useCallback(() => {
-         if (isAutoUpdateActive) return
- 
-         // Get location immediately
-         getCurrentLocation()
- 
-         // Then set up interval for regular updates (every 5 minutes)
-         const interval = setInterval(() => {
-             getCurrentLocation()
-         }, 5 * 60 * 1000) // 5 minutes
- 
-         setLocationUpdateInterval(interval)
-         setIsAutoUpdateActive(true)
-     }, [isAutoUpdateActive, getCurrentLocation])
- 
-     // Stop automatic location updates
-     const stopLocationUpdates = () => {
-         if (locationUpdateInterval) {
-             clearInterval(locationUpdateInterval)
-             setLocationUpdateInterval(null)
-         }
- 
-         setIsAutoUpdateActive(false)
-     }
- 
-     // Toggle location sharing
-     const handleToggleLocationSharing = () => {
-         updateSharingStatusMutation.mutate(!isLocationSharingEnabled)
-     }
- 
-     // Manually share current location
-     const handleShareLocation = () => {
-         if (!currentLocation) {
-             getCurrentLocation()
-             setIsManualUpdate(true)
+ 
+     const handleToggleSharing = async (enabled: boolean) => {
+         try {
+             if (enabled && !currentPosition) {
+                 await getCurrentLocation()
+             }
+ 
+             await toggleLocationSharing(enabled)
+ 
+             if (enabled) {
+                 toast.success('Location sharing enabled')
+             } else {
+                 toast.success('Location sharing disabled')
+             }
+         } catch (err) {
+             toast.error(err instanceof Error ? err.message : 'Failed to toggle location sharing')
+         }
+     }
+ 
+     const handleShareEmergency = async () => {
+         if (!currentPosition) {
+             await getCurrentLocation()
              return
          }
  
-         shareLocationMutation.mutate({
-             location: currentLocation,
-             name: locationName || 'Current Location',
-             message: `I'm at ${locationName || 'this location'} now!`
-         })
-     }
- 
-     // Update location manually
-     const handleUpdateLocation = () => {
-         getCurrentLocation()
- 
-         toast("Location updated", {
-             description: "Your location has been refreshed"
-         })
-     }
- 
-     // Format time ago
-     const formatTimeAgo = (date: Date) => {
-         return formatDistanceToNow(date, { addSuffix: true })
+         try {
+             await shareLocation(
+                 {
+                     latitude: currentPosition.coords.latitude,
+                     longitude: currentPosition.coords.longitude,
+                     accuracy: currentPosition.coords.accuracy,
+                     name: 'Emergency Location'
+                 },
+                 'Emergency assistance needed!',
+                 true
+             )
+             toast.success('Emergency location shared with group')
+         } catch (err) {
+             toast.error('Failed to share emergency location')
+         }
      }
  
      const getInitials = (name: string) => {
-         return name
-             .split(' ')
-             .map(part => part[0])
-             .join('')
-             .toUpperCase()
-             .slice(0, 2)
+         return name.split(' ').map(word => word[0]).join('').toUpperCase().slice(0, 2)
      }
  
-     if (isStatusesLoading) {
+     const sortedUpdates = Object.entries(locationUpdates || {})
+         .sort(([, a], [, b]) => b.timestamp - a.timestamp)
+         .slice(0, 5) // Show last 5 updates
+ 
+     const activeSharingMembers = Object.entries(memberLocations || {})
+         .filter(([, member]) => member.isSharing)
+ 
+     if (loading) {
          return (
-             <div className="flex items-center justify-center h-64">
+             <Card className={className}>
+                 <CardContent className="flex items-center justify-center h-64">
                      <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
-             </div>
+                 </CardContent>
+             </Card>
          )
      }
  
      return (
-         <Card className="w-full">
+         <Card className={className}>
              <CardHeader>
-                 <div className="flex justify-between items-center">
-                     <div>
                  <CardTitle className="flex items-center gap-2">
-                             <MapPin className="h-5 w-5" />
+                     <Navigation className="h-5 w-5" />
                      Location Sharing
+                     <Badge variant="secondary" className="ml-auto">
+                         {activeSharingMembers.length} sharing
+                     </Badge>
                  </CardTitle>
-                         <CardDescription>
-                             Share your location with your vacation party
-                         </CardDescription>
+             </CardHeader>
+ 
+             <CardContent className="space-y-6">
+                 {/* Location sharing toggle */}
+                 <div className="flex items-center justify-between">
+                     <div className="space-y-1">
+                         <p className="font-medium">Share my location</p>
+                         <p className="text-sm text-muted-foreground">
+                             Let your group see your current location
+                         </p>
                      </div>
-                     <div className="flex items-center gap-2">
-                         <div className="flex items-center gap-2">
                      <Switch
-                                 id="location-sharing"
-                                 checked={isLocationSharingEnabled}
-                                 onCheckedChange={handleToggleLocationSharing}
-                             />
-                             <span className="text-sm font-medium">
-                                 {isLocationSharingEnabled ? 'On' : 'Off'}
-                             </span>
-                         </div>
-                     </div>
+                         checked={isSharing}
+                         onCheckedChange={handleToggleSharing}
+                         disabled={gettingLocation}
+                     />
                  </div>
-             </CardHeader>
  
-             <CardContent>
+                 {/* Location error */}
                  {locationError && (
-                     <Alert variant="destructive" className="mb-4">
-                         <AlertCircle className="h-4 w-4" />
-                         <AlertTitle>Error</AlertTitle>
+                     <Alert variant="destructive">
+                         <AlertTriangle className="h-4 w-4" />
+                         <AlertTitle>Location Error</AlertTitle>
                          <AlertDescription>{locationError}</AlertDescription>
                      </Alert>
                  )}
  
-                 <Tabs defaultValue="map">
-                     <TabsList className="w-full grid grid-cols-3 mb-4">
-                         <TabsTrigger value="map">Map</TabsTrigger>
-                         <TabsTrigger value="party">Party Locations</TabsTrigger>
-                         <TabsTrigger value="history">Location History</TabsTrigger>
-                     </TabsList>
- 
-                     <TabsContent value="map">
-                         <div className="bg-muted rounded-md overflow-hidden h-[300px]">
-                             {activeSharings.length > 0 ? (
-                                 <InteractiveMap
-                                     height="300px"
-                                     width="100%"
-                                     showSearch={false}
-                                     showUserLocation={true}
-                                     groupMembers={formatGroupMembersForMap(locationStatuses)}
-                                     initialCenter={currentLocation ?
-                                         {
-                                             lat: currentLocation.coords.latitude,
-                                             lng: currentLocation.coords.longitude
-                                         } : undefined}
-                                     initialZoom={13}
-                                     onLocationUpdate={(location) => {
-                                         if (isLocationSharingEnabled) {
-                                             // Create a GeolocationPosition-like object from the map location update
-                                             const simulatedPosition = {
-                                                 coords: {
-                                                     latitude: location.lat,
-                                                     longitude: location.lng,
-                                                     accuracy: 10
-                                                 },
-                                                 timestamp: Date.now()
-                                             } as GeolocationPosition;
- 
-                                             // Share the location
-                                             shareLocationMutation.mutate({
-                                                 location: simulatedPosition,
-                                                 name: locationName || 'Current Location',
-                                             });
-                                         }
-                                     }}
-                                 />
-                             ) : (
-                                 <div className="h-full w-full flex items-center justify-center">
-                                     <div className="text-center">
-                                         <MapIcon className="h-10 w-10 mx-auto mb-2 opacity-20" />
-                                         <p className="text-muted-foreground">No party members sharing location</p>
-                                         <p className="text-xs text-muted-foreground mt-1">Enable location sharing to see the map</p>
-                                     </div>
-                                 </div>
-                             )}
+                 {/* Emergency button */}
+                 <div className="space-y-2">
+                     <Button
+                         variant="destructive"
+                         onClick={handleShareEmergency}
+                         disabled={gettingLocation}
+                         className="w-full"
+                     >
+                         <AlertTriangle className="h-4 w-4 mr-2" />
+                         Share Emergency Location
+                     </Button>
+                     <p className="text-xs text-muted-foreground text-center">
+                         This will immediately alert your group with your location
+                     </p>
                  </div>
  
-                         <div className="mt-4">
-                             <div className="flex justify-between">
+                 {/* Quick location button */}
                  <Button
                      variant="outline"
-                                     size="sm"
-                                     onClick={handleUpdateLocation}
-                                     disabled={!isLocationSharingEnabled}
-                                     className="gap-1"
+                     onClick={getCurrentLocation}
+                     disabled={gettingLocation}
+                     className="w-full"
                  >
-                                     <RefreshCw className="h-4 w-4" />
-                                     Refresh Location
+                     {gettingLocation ? (
+                         <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"></div>
+                     ) : (
+                         <Locate className="h-4 w-4 mr-2" />
+                     )}
+                     Get Current Location
                  </Button>
  
-                                 <div className="flex gap-2">
-                                     <TooltipProvider>
-                                         <Tooltip>
-                                             <TooltipTrigger asChild>
-                                                 <Badge variant="outline" className="py-1">
-                                                     <Clock className="h-3 w-3 mr-1" />
-                                                     Updated {currentUserStatus?.lastUpdated
-                                                         ? formatTimeAgo(currentUserStatus.lastUpdated)
-                                                         : 'never'}
-                                                 </Badge>
-                                             </TooltipTrigger>
-                                             <TooltipContent>
-                                                 <p>Last location update time</p>
-                                             </TooltipContent>
-                                         </Tooltip>
-                                     </TooltipProvider>
- 
-                                     <Badge variant={isLocationSharingEnabled ? "default" : "secondary"} className="py-1">
-                                         {isLocationSharingEnabled
-                                             ? <Eye className="h-3 w-3 mr-1" />
-                                             : <EyeOff className="h-3 w-3 mr-1" />
-                                         }
-                                         {isLocationSharingEnabled ? 'Visible to party' : 'Hidden'}
-                                     </Badge>
-                                 </div>
-                             </div>
- 
-                             <div className="mt-4">
+                 {/* Active sharing members */}
+                 {activeSharingMembers.length > 0 && (
+                     <div className="space-y-3">
+                         <h4 className="font-medium flex items-center gap-2">
+                             <Users className="h-4 w-4" />
+                             Members Sharing Location ({activeSharingMembers.length})
+                         </h4>
                          <div className="space-y-2">
-                                     <div className="text-sm font-medium">Share with a message</div>
-                                     <div className="flex gap-2">
-                                         <Input
-                                             placeholder="Where are you? (e.g., Space Mountain)"
-                                             value={locationName}
-                                             onChange={(e) => setLocationName(e.target.value)}
-                                             disabled={!isLocationSharingEnabled}
-                                         />
-                                         <Button
-                                             onClick={handleShareLocation}
-                                             disabled={!isLocationSharingEnabled}
-                                         >
-                                             <Share className="h-4 w-4 mr-2" />
-                                             Share
-                                         </Button>
+                             {activeSharingMembers.map(([userId, member]) => (
+                                 <div key={userId} className="flex items-center gap-3 p-2 bg-muted rounded-lg">
+                                     <Avatar className="h-8 w-8">
+                                         <AvatarImage src={member.userPhotoURL} />
+                                         <AvatarFallback className="text-xs">
+                                             {getInitials(member.userName)}
+                                         </AvatarFallback>
+                                     </Avatar>
+                                     <div className="flex-1 min-w-0">
+                                         <p className="font-medium text-sm">{member.userName}</p>
+                                         {member.location && (
+                                             <p className="text-xs text-muted-foreground">
+                                                 {member.location.name || 'Unknown location'}
+                                             </p>
+                                         )}
                                      </div>
-                                     <div className="text-xs text-muted-foreground">
-                                         Sharing your location will notify other party members
+                                     <div className="flex items-center gap-1 text-xs text-muted-foreground">
+                                         <Clock className="h-3 w-3" />
+                                         {formatDistanceToNow(new Date(member.lastUpdated), { addSuffix: true })}
                                      </div>
                                  </div>
-                             </div>
+                             ))}
                          </div>
-                     </TabsContent>
- 
-                     <TabsContent value="party">
-                         <div className="space-y-4 mb-4">
-                             <div className="text-sm font-medium flex items-center gap-1">
-                                 <Users className="h-4 w-4" />
-                                 Party Members ({activeSharings.length} sharing)
-                             </div>
- 
-                             {locationStatuses && locationStatuses.length > 0 ? (
-                                 <ScrollArea className="h-[250px]">
-                                     <div className="space-y-2">
-                                         {locationStatuses.map(status => (
-                                             <div
-                                                 key={status.userId}
-                                                 className={cn(
-                                                     "flex items-center justify-between border rounded-md p-3",
-                                                     status.isSharing ? "border-primary/30 bg-primary/5" : "border-muted"
-                                                 )}
-                                             >
-                                                 <div className="flex items-center gap-3">
-                                                     <Avatar>
-                                                         <AvatarImage src={status.userPhotoURL} />
-                                                         <AvatarFallback>{getInitials(status.userName)}</AvatarFallback>
-                                                     </Avatar>
- 
-                                                     <div>
-                                                         <div className="font-medium">{status.userName}</div>
-                                                         {status.isSharing ? (
-                                                             <div className="text-xs text-muted-foreground flex items-center gap-1">
-                                                                 <MapPin className="h-3 w-3 text-green-500" />
-                                                                 {status.lastLocation?.name || 'Unknown location'}
-                                                             </div>
-                                                         ) : (
-                                                             <div className="text-xs text-muted-foreground flex items-center gap-1">
-                                                                 <EyeOff className="h-3 w-3" />
-                                                                 Not sharing location
                      </div>
                  )}
-                                                     </div>
-                                                 </div>
- 
-                                                 {status.isSharing && status.lastUpdated && (
-                                                     <Badge variant="outline" className="h-5 text-xs">
-                                                         <Clock className="h-3 w-3 mr-1" />
-                                                         {formatTimeAgo(status.lastUpdated)}
+ 
+                 {/* Recent location updates */}
+                 {sortedUpdates.length > 0 && (
+                     <div className="space-y-3">
+                         <h4 className="font-medium flex items-center gap-2">
+                             <MapPin className="h-4 w-4" />
+                             Recent Updates
+                         </h4>
+                         <div className="space-y-2">
+                             {sortedUpdates.map(([updateId, update]) => (
+                                 <div key={updateId} className={`p-3 rounded-lg border ${
+                                     update.isEmergency ? 'border-destructive bg-destructive/5' : 'border-border'
+                                 }`}>
+                                     <div className="flex items-start gap-3">
+                                         <Avatar className="h-6 w-6">
+                                             <AvatarImage src={update.userPhotoURL} />
+                                             <AvatarFallback className="text-xs">
+                                                 {getInitials(update.userName)}
+                                             </AvatarFallback>
+                                         </Avatar>
+                                         <div className="flex-1 min-w-0">
+                                             <div className="flex items-center gap-2">
+                                                 <p className="font-medium text-sm">{update.userName}</p>
+                                                 {update.isEmergency && (
+                                                     <Badge variant="destructive" className="text-xs">
+                                                         Emergency
                                                      </Badge>
                                                  )}
                                              </div>
-                                         ))}
+                                             <p className="text-xs text-muted-foreground">
+                                                 {update.location.name}
+                                             </p>
+                                             {update.message && (
+                                                 <p className="text-sm mt-1">{update.message}</p>
+                                             )}
+                                             <p className="text-xs text-muted-foreground mt-1">
+                                                 {formatDistanceToNow(new Date(update.timestamp), { addSuffix: true })}
+                                             </p>
+                                         </div>
                                      </div>
-                                 </ScrollArea>
-                             ) : (
-                                 <div className="text-center p-8 text-muted-foreground">
-                                     <Users className="h-10 w-10 mx-auto mb-2 opacity-20" />
-                                     <p>No party members yet</p>
-                                     <p className="text-sm">Invite others to see their location</p>
                                  </div>
-                             )}
- 
-                             <div className="text-xs text-muted-foreground bg-muted p-2 rounded-md flex items-start gap-2">
-                                 <Info className="h-4 w-4 mt-0.5 flex-shrink-0" />
-                                 <div>
-                                     <p className="font-medium">Location Privacy</p>
-                                     <p>Your location is only shared with your vacation party members and only when you have sharing turned on. You can turn it off at any time.</p>
-                                 </div>
-                             </div>
+                             ))}
                          </div>
-                     </TabsContent>
- 
-                     <TabsContent value="history">
-                         {locationUpdates && locationUpdates.length > 0 ? (
-                             <ScrollArea className="h-[300px]">
-                                 <div className="space-y-4">
-                                     {locationUpdates.map(update => (
-                                         <motion.div
-                                             key={update.id}
-                                             initial={{ opacity: 0, y: 10 }}
-                                             animate={{ opacity: 1, y: 0 }}
-                                             className="flex items-start gap-3 border-b pb-4"
-                                         >
-                                             <Avatar className="mt-1">
-                                                 <AvatarImage src={update.userPhotoURL} />
-                                                 <AvatarFallback>{getInitials(update.userName)}</AvatarFallback>
-                                             </Avatar>
- 
-                                             <div className="flex-1">
-                                                 <div className="flex justify-between">
-                                                     <div className="font-medium">{update.userName}</div>
-                                                     <div className="text-xs text-muted-foreground">
-                                                         {format(update.timestamp, 'MMM d, h:mm a')}
-                                                     </div>
-                                                 </div>
- 
-                                                 <div className="flex items-center gap-1 text-sm text-primary">
-                                                     <MapPin className="h-4 w-4" />
-                                                     {update.location.name}
                      </div>
- 
-                                                 {update.message && (
-                                                     <div className="mt-1 text-sm">{update.message}</div>
-                                                 )}
- 
-                                                 <Button
-                                                     variant="ghost"
-                                                     size="sm"
-                                                     className="mt-1 h-7 px-2 text-xs"
-                                                 >
-                                                     View on Map
-                                                 </Button>
-                                             </div>
-                                         </motion.div>
-                                     ))}
-                                 </div>
-                             </ScrollArea>
-                         ) : (
-                             <div className="text-center p-8 text-muted-foreground">
-                                 <MapPin className="h-10 w-10 mx-auto mb-2 opacity-20" />
+                 )}
+ 
+                 {/* No updates message */}
+                 {sortedUpdates.length === 0 && activeSharingMembers.length === 0 && (
+                     <div className="text-center py-8 text-muted-foreground">
+                         <Navigation className="h-12 w-12 mx-auto mb-4 opacity-50" />
                          <p>No location updates yet</p>
-                                 <p className="text-sm">Share your location to see updates here</p>
+                         <p className="text-sm">Enable location sharing to see group member locations</p>
                      </div>
                  )}
-                     </TabsContent>
-                 </Tabs>
              </CardContent>
- 
-             {!isLocationSharingEnabled && (
-                 <CardFooter className="border-t">
-                     <Button onClick={handleToggleLocationSharing} className="w-full">
-                         <MapPin className="h-4 w-4 mr-2" />
-                         Enable Location Sharing
-                     </Button>
-                 </CardFooter>
-             )}
          </Card>
      )
```

---

Finally, let me create a simple example of how to use these components in your dashboard:

---

```diff
- import { Suspense } from "react"
- import { Metadata } from "next"
- import VacationParty from "@/components/group/VacationParty"
- import PartyMessaging from "@/components/group/PartyMessaging"
- import LocationSharing from "@/components/group/LocationSharing"
- import CollaborativeItinerary from "@/components/group/CollaborativeItinerary"
- import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
- import { Button } from "@/components/ui/button"
+ 'use client'
+ 
+ import { use } from 'react'
+ import { useAuth } from '@/contexts/AuthContext'
+ import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
+ import { Badge } from '@/components/ui/badge'
+ import { Button } from '@/components/ui/button'
+ import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
+ import GroupChat from '@/components/group/GroupChat'
+ import LocationSharing from '@/components/group/LocationSharing'
+ import { useVacationRealtime } from '@/hooks/useRealtimeDatabase'
  import {
      Users,
      MessageSquare,
      MapPin,
-     Calendar,
+     Clock,
+     Settings,
      Share2,
-     Plus,
-     ArrowRight,
-     CalendarDays,
-     Map
- } from "lucide-react"
- import {
-     Card,
-     CardContent,
-     CardHeader,
-     CardTitle,
-     CardFooter,
- } from "@/components/ui/card"
- import {
-     Breadcrumb,
-     BreadcrumbItem,
-     BreadcrumbLink,
-     BreadcrumbList,
-     BreadcrumbPage,
-     BreadcrumbSeparator
- } from "@/components/ui/breadcrumb"
- import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
- import Link from "next/link"
- import { Badge } from "@/components/ui/badge"
- 
- export const metadata: Metadata = {
-     title: "Vacation Party | Disney Vacation Planning",
-     description: "Plan your Disney vacation with friends and family",
+     Bell
+ } from 'lucide-react'
+ import { formatDistanceToNow } from 'date-fns'
+ import { toast } from 'sonner'
+ 
+ interface GroupDashboardProps {
+     params: Promise<{
+         vacationId: string
+     }>
  }
  
- export default function VacationGroupPage({ params }: { readonly params: { vacationId: string } }) {
-     const { vacationId } = params
- 
+ export default function GroupDashboard({ params }: GroupDashboardProps) {
+     const { vacationId } = use(params)
+     const { user } = useAuth()
+ 
+     const {
+         messages,
+         locationSharing,
+         notifications,
+         isLoading,
+         hasError
+     } = useVacationRealtime(vacationId)
+ 
+     if (!user) {
          return (
-         <div className="container py-6">
-             <Breadcrumb className="mb-6">
-                 <BreadcrumbList>
-                     <BreadcrumbItem>
-                         <BreadcrumbLink href="/dashboard">Dashboard</BreadcrumbLink>
-                     </BreadcrumbItem>
-                     <BreadcrumbSeparator />
-                     <BreadcrumbItem>
-                         <BreadcrumbLink href="/group">Vacation Parties</BreadcrumbLink>
-                     </BreadcrumbItem>
-                     <BreadcrumbSeparator />
-                     <BreadcrumbItem>
-                         <BreadcrumbPage>Magic Kingdom Adventure 2023</BreadcrumbPage>
-                     </BreadcrumbItem>
-                 </BreadcrumbList>
-             </Breadcrumb>
- 
-             <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
-                 <div className="md:col-span-2">
-                     <div className="flex flex-col gap-2">
-                         <h1 className="text-3xl font-bold tracking-tight">Magic Kingdom Adventure 2023</h1>
-                         <p className="text-muted-foreground">
-                             Collaborate with your friends and family on your Disney vacation
-                         </p>
- 
-                         <div className="flex gap-2 mt-2">
-                             <div className="flex -space-x-2">
-                                 <Avatar className="h-8 w-8 border-2 border-background">
-                                     <AvatarImage src="/app/user1.jpg" />
-                                     <AvatarFallback>JD</AvatarFallback>
-                                 </Avatar>
-                                 <Avatar className="h-8 w-8 border-2 border-background">
-                                     <AvatarImage src="/app/user2.jpg" />
-                                     <AvatarFallback>JS</AvatarFallback>
-                                 </Avatar>
-                                 <Avatar className="h-8 w-8 border-2 border-background">
-                                     <AvatarImage src="/app/user3.jpg" />
-                                     <AvatarFallback>AJ</AvatarFallback>
-                                 </Avatar>
-                                 <Avatar className="h-8 w-8 border-2 border-background">
-                                     <AvatarFallback>+2</AvatarFallback>
-                                 </Avatar>
+             <div className="container mx-auto p-6">
+                 <Card>
+                     <CardContent className="flex items-center justify-center h-64">
+                         <p>Please sign in to access group features</p>
+                     </CardContent>
+                 </Card>
+             </div>
+         )
+     }
+ 
+     if (isLoading) {
+         return (
+             <div className="container mx-auto p-6">
+                 <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
+                     {[1, 2, 3].map((i) => (
+                         <Card key={i}>
+                             <CardContent className="flex items-center justify-center h-64">
+                                 <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
+                             </CardContent>
+                         </Card>
+                     ))}
                  </div>
-                             <div className="text-muted-foreground text-sm flex items-center">
-                                 6 members in this vacation party
              </div>
+         )
+     }
+ 
+     if (hasError) {
+         return (
+             <div className="container mx-auto p-6">
+                 <Card>
+                     <CardContent className="flex items-center justify-center h-64">
+                         <div className="text-center">
+                             <p className="text-destructive mb-4">Error loading group data</p>
+                             <Button onClick={() => window.location.reload()}>
+                                 Try Again
+                             </Button>
                          </div>
+                     </CardContent>
+                 </Card>
              </div>
+         )
+     }
+ 
+     const totalMessages = Object.keys(messages.messages || {}).length
+     const activeSharers = Object.values(locationSharing.memberLocations || {})
+         .filter((member: any) => member.isSharing).length
+     const unreadNotifications = notifications.unreadCount
+ 
+     const handleInviteMembers = () => {
+         // Generate shareable link
+         const shareUrl = `${window.location.origin}/shared-itinerary/${vacationId}`
+ 
+         if (navigator.share) {
+             navigator.share({
+                 title: 'Join my Disney vacation planning',
+                 text: 'Join my vacation group to chat and share locations!',
+                 url: shareUrl
+             }).catch(() => {
+                 // Fallback to clipboard
+                 navigator.clipboard.writeText(shareUrl)
+                 toast.success('Invite link copied to clipboard!')
+             })
+         } else {
+             navigator.clipboard.writeText(shareUrl)
+             toast.success('Invite link copied to clipboard!')
+         }
+     }
+ 
+     return (
+         <div className="container mx-auto p-6 space-y-6">
+             {/* Header */}
+             <div className="flex items-center justify-between">
+                 <div>
+                     <h1 className="text-3xl font-bold">Group Dashboard</h1>
+                     <p className="text-muted-foreground">
+                         Collaborate with your vacation party
+                     </p>
                  </div>
  
-                 <div className="flex justify-end items-start gap-2">
-                     <Button variant="outline" size="sm">
+                 <div className="flex items-center gap-4">
+                     {/* Notifications */}
+                     {unreadNotifications > 0 && (
+                         <div className="relative">
+                             <Bell className="h-6 w-6" />
+                             <Badge
+                                 variant="destructive"
+                                 className="absolute -top-2 -right-2 h-5 w-5 flex items-center justify-center p-0 text-xs"
+                             >
+                                 {unreadNotifications}
+                             </Badge>
+                         </div>
+                     )}
+ 
+                     <Button onClick={handleInviteMembers} variant="outline">
                          <Share2 className="h-4 w-4 mr-2" />
-                         Share
+                         Invite Members
                      </Button>
-                     <Button size="sm">
-                         <Plus className="h-4 w-4 mr-2" />
-                         Invite
+ 
+                     <Button variant="outline">
+                         <Settings className="h-4 w-4 mr-2" />
+                         Settings
                      </Button>
                  </div>
              </div>
  
-             <div className="grid grid-cols-1 md:grid-cols-12 gap-6 mb-8">
-                 <Card className="md:col-span-4">
-                     <CardHeader className="pb-3">
-                         <CardTitle className="text-sm font-medium flex items-center gap-1">
-                             <CalendarDays className="h-4 w-4" />
-                             Trip Details
-                         </CardTitle>
+             {/* Stats Cards */}
+             <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
+                 <Card>
+                     <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
+                         <CardTitle className="text-sm font-medium">Group Messages</CardTitle>
+                         <MessageSquare className="h-4 w-4 text-muted-foreground" />
                      </CardHeader>
-                     <CardContent className="py-1">
-                         <div className="space-y-3">
-                             <div>
-                                 <div className="text-xs text-muted-foreground">Dates</div>
-                                 <div className="font-medium">Dec 15 - Dec 22, 2023</div>
-                             </div>
-                             <div>
-                                 <div className="text-xs text-muted-foreground">Destination</div>
-                                 <div className="font-medium">Walt Disney World Resort</div>
-                             </div>
-                             <div>
-                                 <div className="text-xs text-muted-foreground">Resort</div>
-                                 <div className="font-medium">Disney&apos;s Contemporary Resort</div>
-                             </div>
-                         </div>
+                     <CardContent>
+                         <div className="text-2xl font-bold">{totalMessages}</div>
+                         <p className="text-xs text-muted-foreground">
+                             {messages.loading ? 'Loading...' : 'Total messages sent'}
+                         </p>
                      </CardContent>
-                     <CardFooter className="pt-3 pb-2 border-t">
-                         <Link href={`/resorts/${vacationId}`} className="text-xs text-primary flex items-center">
-                             View Resort Details
-                             <ArrowRight className="h-3 w-3 ml-1" />
-                         </Link>
-                     </CardFooter>
                  </Card>
  
-                 <Card className="md:col-span-4">
-                     <CardHeader className="pb-3">
-                         <CardTitle className="text-sm font-medium flex items-center gap-1">
-                             <Calendar className="h-4 w-4" />
-                             Trip Countdown
-                         </CardTitle>
+                 <Card>
+                     <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
+                         <CardTitle className="text-sm font-medium">Active Sharers</CardTitle>
+                         <MapPin className="h-4 w-4 text-muted-foreground" />
                      </CardHeader>
-                     <CardContent className="py-1 flex items-center justify-center">
-                         <div className="text-center">
-                             <div className="text-4xl font-bold">14</div>
-                             <p className="text-muted-foreground">Days until your trip</p>
-                         </div>
+                     <CardContent>
+                         <div className="text-2xl font-bold">{activeSharers}</div>
+                         <p className="text-xs text-muted-foreground">
+                             {locationSharing.loading ? 'Loading...' : 'Sharing locations'}
+                         </p>
                      </CardContent>
-                     <CardFooter className="pt-3 pb-2 border-t">
-                         <Link href={`/planning/${vacationId}`} className="text-xs text-primary flex items-center">
-                             View Trip Planner
-                             <ArrowRight className="h-3 w-3 ml-1" />
-                         </Link>
-                     </CardFooter>
                  </Card>
  
-                 <Card className="md:col-span-4">
-                     <CardHeader className="pb-3">
-                         <CardTitle className="text-sm font-medium flex items-center gap-1">
-                             <Map className="h-4 w-4" />
-                             Active Now
-                         </CardTitle>
+                 <Card>
+                     <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
+                         <CardTitle className="text-sm font-medium">Last Activity</CardTitle>
+                         <Clock className="h-4 w-4 text-muted-foreground" />
                      </CardHeader>
-                     <CardContent className="py-1">
-                         <div className="space-y-3">
-                             <div className="flex justify-between items-center">
-                                 <div className="flex items-center gap-2">
-                                     <Avatar className="h-6 w-6">
-                                         <AvatarImage src="/app/user1.jpg" />
-                                         <AvatarFallback>JD</AvatarFallback>
-                                     </Avatar>
-                                     <span className="text-sm">John Doe</span>
-                                 </div>
-                                 <Badge variant="outline" className="text-xs h-5 px-1.5 bg-green-500/10 text-green-500 hover:bg-green-500/20">Online</Badge>
-                             </div>
-                             <div className="flex justify-between items-center">
-                                 <div className="flex items-center gap-2">
-                                     <Avatar className="h-6 w-6">
-                                         <AvatarImage src="/app/user2.jpg" />
-                                         <AvatarFallback>JS</AvatarFallback>
-                                     </Avatar>
-                                     <span className="text-sm">Jane Smith</span>
-                                 </div>
-                                 <Badge variant="outline" className="text-xs h-5 px-1.5 bg-green-500/10 text-green-500 hover:bg-green-500/20">Online</Badge>
-                             </div>
-                             <div className="flex justify-between items-center">
-                                 <div className="flex items-center gap-2">
-                                     <Avatar className="h-6 w-6">
-                                         <AvatarImage src="/app/user3.jpg" />
-                                         <AvatarFallback>AJ</AvatarFallback>
-                                     </Avatar>
-                                     <span className="text-sm">Alex Johnson</span>
-                                 </div>
-                                 <Badge variant="outline" className="text-xs h-5 px-1.5 bg-muted text-muted-foreground">Offline</Badge>
-                             </div>
+                     <CardContent>
+                         <div className="text-2xl font-bold">
+                             {totalMessages > 0 ? (
+                                 formatDistanceToNow(
+                                     new Date(
+                                         Math.max(
+                                             ...Object.values(messages.messages || {})
+                                                 .map((msg: any) => msg.timestamp)
+                                         )
+                                     ),
+                                     { addSuffix: true }
+                                 )
+                             ) : (
+                                 'No activity'
+                             )}
                          </div>
+                         <p className="text-xs text-muted-foreground">
+                             Last message sent
+                         </p>
                      </CardContent>
-                     <CardFooter className="pt-3 pb-2 border-t">
-                         <Link href="#messaging" className="text-xs text-primary flex items-center">
-                             Send Message
-                             <ArrowRight className="h-3 w-3 ml-1" />
-                         </Link>
-                     </CardFooter>
                  </Card>
              </div>
  
-             <Tabs defaultValue="party" className="space-y-6">
-                 <div className="border-b">
-                     <TabsList className="w-full justify-start rounded-none border-b-0 px-0">
-                         <TabsTrigger
-                             value="party"
-                             className="py-3 px-4 relative data-[state=active]:bg-transparent data-[state=active]:shadow-none rounded-none border-0"
-                             data-state="active"
-                         >
-                             <Users className="h-4 w-4 mr-2" />
-                             <span>Party</span>
-                             <div className="absolute bottom-0 left-0 right-0 h-[2px] bg-primary data-[state=inactive]:opacity-0 transition-opacity" data-state="active" />
+             {/* Main Content */}
+             <Tabs defaultValue="chat" className="space-y-6">
+                 <TabsList className="grid w-full grid-cols-2">
+                     <TabsTrigger value="chat" className="flex items-center gap-2">
+                         <MessageSquare className="h-4 w-4" />
+                         Group Chat
+                         {totalMessages > 0 && (
+                             <Badge variant="secondary" className="ml-2">
+                                 {totalMessages}
+                             </Badge>
+                         )}
                      </TabsTrigger>
- 
-                         <TabsTrigger
-                             value="messaging"
-                             className="py-3 px-4 relative data-[state=active]:bg-transparent data-[state=active]:shadow-none rounded-none border-0"
-                             id="messaging"
-                         >
-                             <MessageSquare className="h-4 w-4 mr-2" />
-                             <span>Messaging</span>
-                             <div className="absolute bottom-0 left-0 right-0 h-[2px] bg-primary data-[state=inactive]:opacity-0 transition-opacity" data-state="inactive" />
+                     <TabsTrigger value="location" className="flex items-center gap-2">
+                         <MapPin className="h-4 w-4" />
+                         Location Sharing
+                         {activeSharers > 0 && (
+                             <Badge variant="secondary" className="ml-2">
+                                 {activeSharers}
+                             </Badge>
+                         )}
                      </TabsTrigger>
- 
-                         <TabsTrigger
-                             value="location"
-                             className="py-3 px-4 relative data-[state=active]:bg-transparent data-[state=active]:shadow-none rounded-none border-0"
-                         >
-                             <MapPin className="h-4 w-4 mr-2" />
-                             <span>Location</span>
-                             <div className="absolute bottom-0 left-0 right-0 h-[2px] bg-primary data-[state=inactive]:opacity-0 transition-opacity" data-state="inactive" />
-                         </TabsTrigger>
- 
-                         <TabsTrigger
-                             value="planning"
-                             className="py-3 px-4 relative data-[state=active]:bg-transparent data-[state=active]:shadow-none rounded-none border-0"
+                 </TabsList>
+ 
+                 <TabsContent value="chat" className="space-y-6">
+                     <div className="grid grid-cols-1 xl:grid-cols-3 gap-6">
+                         <div className="xl:col-span-2">
+                             <GroupChat vacationId={vacationId} />
+                         </div>
+ 
+                         <div className="space-y-4">
+                             <Card>
+                                 <CardHeader>
+                                     <CardTitle className="text-lg">Quick Actions</CardTitle>
+                                 </CardHeader>
+                                 <CardContent className="space-y-3">
+                                     <Button
+                                         variant="outline"
+                                         className="w-full justify-start"
+                                         onClick={handleInviteMembers}
+                                     >
+                                         <Users className="h-4 w-4 mr-2" />
+                                         Invite Members
+                                     </Button>
+                                     <Button
+                                         variant="outline"
+                                         className="w-full justify-start"
+                                         onClick={() => {
+                                             // Navigate to itinerary
+                                             window.location.href = `/dashboard/itinerary/${vacationId}`
+                                         }}
                                      >
                                          <Calendar className="h-4 w-4 mr-2" />
-                             <span>Planning</span>
-                             <div className="absolute bottom-0 left-0 right-0 h-[2px] bg-primary data-[state=inactive]:opacity-0 transition-opacity" data-state="inactive" />
-                         </TabsTrigger>
-                     </TabsList>
+                                         View Itinerary
+                                     </Button>
+                                 </CardContent>
+                             </Card>
+ 
+                             {/* Recent Notifications */}
+                             {Object.keys(notifications.notifications || {}).length > 0 && (
+                                 <Card>
+                                     <CardHeader>
+                                         <CardTitle className="text-lg flex items-center gap-2">
+                                             <Bell className="h-5 w-5" />
+                                             Recent Notifications
+                                         </CardTitle>
+                                     </CardHeader>
+                                     <CardContent>
+                                         <div className="space-y-2">
+                                             {Object.entries(notifications.notifications || {})
+                                                 .slice(0, 3)
+                                                 .map(([notificationId, notification]: [string, any]) => (
+                                                 <div
+                                                     key={notificationId}
+                                                     className={`p-3 rounded-lg border text-sm ${
+                                                         notification.read
+                                                             ? 'bg-muted/50'
+                                                             : 'bg-primary/5 border-primary/20'
+                                                     }`}
+                                                 >
+                                                     <p className="font-medium">{notification.title}</p>
+                                                     <p className="text-muted-foreground text-xs">
+                                                         {notification.message}
+                                                     </p>
+                                                     <p className="text-xs text-muted-foreground mt-1">
+                                                         {formatDistanceToNow(new Date(notification.timestamp), { addSuffix: true })}
+                                                     </p>
+                                                 </div>
+                                             ))}
+                                         </div>
+                                     </CardContent>
+                                 </Card>
+                             )}
+                         </div>
                      </div>
- 
-                 <TabsContent value="party" className="space-y-6 mt-0">
-                     <Suspense fallback={<VacationPartyFallback />}>
-                         <VacationParty vacationId={vacationId} />
-                     </Suspense>
                  </TabsContent>
  
-                 <TabsContent value="messaging" className="space-y-6 mt-0">
-                     <Suspense fallback={<MessagingFallback />}>
-                         <PartyMessaging vacationId={vacationId} />
-                     </Suspense>
-                 </TabsContent>
- 
-                 <TabsContent value="location" className="space-y-6 mt-0">
-                     <Suspense fallback={<LocationSharingFallback />}>
+                 <TabsContent value="location" className="space-y-6">
+                     <div className="grid grid-cols-1 xl:grid-cols-3 gap-6">
+                         <div className="xl:col-span-2">
                              <LocationSharing vacationId={vacationId} />
-                     </Suspense>
-                 </TabsContent>
- 
-                 <TabsContent value="planning" className="space-y-6 mt-0">
-                     <Suspense fallback={<CollaborativePlanningFallback />}>
-                         <CollaborativeItinerary vacationId={vacationId} />
-                     </Suspense>
+                         </div>
+ 
+                         <div className="space-y-4">
+                             <Card>
+                                 <CardHeader>
+                                     <CardTitle className="text-lg">Location Tips</CardTitle>
+                                 </CardHeader>
+                                 <CardContent className="space-y-3 text-sm">
+                                     <div className="flex items-start gap-2">
+                                         <div className="w-2 h-2 rounded-full bg-green-500 mt-2 flex-shrink-0" />
+                                         <p>Enable location sharing to let your group know where you are</p>
+                                     </div>
+                                     <div className="flex items-start gap-2">
+                                         <div className="w-2 h-2 rounded-full bg-blue-500 mt-2 flex-shrink-0" />
+                                         <p>Use the emergency button if you need immediate assistance</p>
+                                     </div>
+                                     <div className="flex items-start gap-2">
+                                         <div className="w-2 h-2 rounded-full bg-purple-500 mt-2 flex-shrink-0" />
+                                         <p>Your location is only shared with your vacation group</p>
+                                     </div>
+                                 </CardContent>
+                             </Card>
+                         </div>
+                     </div>
                  </TabsContent>
              </Tabs>
          </div>
      )
  }
- 
- // Fallback components
- function VacationPartyFallback() {
-     return (
-         <Card className="w-full">
-             <CardHeader>
-                 <div className="flex justify-between items-center">
-                     <div>
-                         <div className="h-6 w-40 bg-muted rounded animate-pulse mb-2"></div>
-                         <div className="h-4 w-64 bg-muted rounded animate-pulse"></div>
-                     </div>
-                     <div className="flex gap-2">
-                         <div className="h-8 w-24 bg-muted rounded animate-pulse"></div>
-                         <div className="h-8 w-24 bg-muted rounded animate-pulse"></div>
-                     </div>
-                 </div>
-             </CardHeader>
-             <CardContent>
-                 <div className="h-[300px] bg-muted rounded animate-pulse"></div>
-             </CardContent>
-         </Card>
-     )
- }
- 
- function MessagingFallback() {
-     return (
-         <Card className="w-full">
-             <CardHeader>
-                 <div className="h-6 w-40 bg-muted rounded animate-pulse mb-2"></div>
-                 <div className="h-4 w-64 bg-muted rounded animate-pulse"></div>
-             </CardHeader>
-             <CardContent>
-                 <div className="h-[400px] bg-muted rounded animate-pulse"></div>
-             </CardContent>
-         </Card>
-     )
- }
- 
- function LocationSharingFallback() {
-     return (
-         <Card className="w-full">
-             <CardHeader>
-                 <div className="h-6 w-40 bg-muted rounded animate-pulse mb-2"></div>
-                 <div className="h-4 w-64 bg-muted rounded animate-pulse"></div>
-             </CardHeader>
-             <CardContent>
-                 <div className="h-[300px] bg-muted rounded animate-pulse"></div>
-             </CardContent>
-         </Card>
-     )
- }
- 
- function CollaborativePlanningFallback() {
-     return (
-         <Card className="w-full">
-             <CardHeader>
-                 <div className="h-6 w-40 bg-muted rounded animate-pulse mb-2"></div>
-                 <div className="h-4 w-64 bg-muted rounded animate-pulse"></div>
-             </CardHeader>
-             <CardContent>
-                 <div className="h-[300px] bg-muted rounded animate-pulse"></div>
-             </CardContent>
-         </Card>
-     )
- }
```

---

Now let me fix the import error in the dashboard page:

---

```diff
      Settings,
      Share2,
-     Bell
+     Bell,
+     Calendar
  } from 'lucide-react'
  import { formatDistanceToNow } from 'date-fns'
```

---

Perfect! Now let me create a documentation file explaining the complete Firebase Realtime Database setup:

---

```diff
- 
+ # Firebase Realtime Database Implementation
+ 
+ This document provides comprehensive information about the Firebase Realtime Database implementation in the Disney Vacation Planning app, covering data structure, security, and best practices.
+ 
+ ## Table of Contents
+ 
+ 1. [Overview](#overview)
+ 2. [Environment Setup](#environment-setup)
+ 3. [Data Structure](#data-structure)
+ 4. [Components & Hooks](#components--hooks)
+ 5. [Security Rules](#security-rules)
+ 6. [Usage Examples](#usage-examples)
+ 7. [Best Practices](#best-practices)
+ 8. [Troubleshooting](#troubleshooting)
+ 
+ ## Overview
+ 
+ The Firebase Realtime Database is used for real-time features in the Disney vacation planning app, including:
+ 
+ - **Group Messaging**: Real-time chat between vacation party members
+ - **Location Sharing**: Live location updates and emergency alerts
+ - **Wait Time Updates**: Real-time park and attraction data
+ - **Notifications**: Push notifications and alerts
+ - **Collaboration Features**: Real-time vacation planning updates
+ 
+ ## Environment Setup
+ 
+ ### Required Environment Variables
+ 
+ Add these to your `.env.local` file:
+ 
+ ```env
+ # Firebase Realtime Database URL
+ NEXT_PUBLIC_FIREBASE_DATABASE_URL=https://your-project-id-default-rtdb.firebaseio.com/
+ 
+ # Other Firebase config (already required)
+ NEXT_PUBLIC_FIREBASE_API_KEY=your-api-key
+ NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your-project-id.firebaseapp.com
+ NEXT_PUBLIC_FIREBASE_PROJECT_ID=your-project-id
+ # ... other Firebase variables
+ ```
+ 
+ ### Firebase Console Setup
+ 
+ 1. Go to [Firebase Console](https://console.firebase.google.com/)
+ 2. Select your project
+ 3. Navigate to **Realtime Database**
+ 4. Click **Create Database**
+ 5. Choose your database location (preferably close to your users)
+ 6. Start in **test mode** (we'll add security rules later)
+ 
+ ## Data Structure
+ 
+ The database follows a flattened, denormalized structure optimized for real-time updates:
+ 
+ ```json
+ {
+   "users": {
+     "{userId}": {
+       "profile": {
+         "displayName": "string",
+         "email": "string",
+         "photoURL": "string",
+         "phoneNumber": "string",
+         "createdAt": "timestamp",
+         "lastActive": "timestamp"
+       },
+       "preferences": {
+         "partySize": "number",
+         "hasChildren": "boolean",
+         "childrenAges": ["number"],
+         "mobilityConsiderations": "boolean",
+         "ridePreference": "string",
+         "maxWaitTime": "number",
+         "useGeniePlus": "boolean",
+         "walkingPace": "string",
+         "notifications": {
+           "waitTimes": "boolean",
+           "groupMessages": "boolean",
+           "emergencyAlerts": "boolean"
+         }
+       },
+       "vacationIds": {
+         "{vacationId}": "boolean"
+       },
+       "deviceTokens": {
+         "{tokenId}": {
+           "token": "string",
+           "platform": "string",
+           "lastUpdated": "timestamp"
+         }
+       }
+     }
+   },
+ 
+   "vacations": {
+     "{vacationId}": {
+       "basic": {
+         "name": "string",
+         "description": "string",
+         "destination": "string",
+         "startDate": "string",
+         "endDate": "string",
+         "createdBy": "userId",
+         "createdAt": "timestamp",
+         "updatedAt": "timestamp",
+         "status": "string",
+         "imageUrl": "string",
+         "shareCode": "string"
+       },
+       "members": {
+         "{userId}": {
+           "role": "string",
+           "joinedAt": "timestamp",
+           "permissions": {
+             "editItinerary": "boolean",
+             "manageBudget": "boolean",
+             "inviteOthers": "boolean"
+           }
+         }
+       },
+       "accommodation": {
+         "resortId": "string",
+         "resortName": "string",
+         "roomType": "string",
+         "checkIn": "string",
+         "checkOut": "string",
+         "confirmationNumber": "string"
+       },
+       "travelers": {
+         "adults": "number",
+         "children": "number",
+         "childrenAges": ["number"]
+       }
+     }
+   },
+ 
+   "groupMessages": {
+     "{vacationId}": {
+       "{messageId}": {
+         "userId": "string",
+         "userName": "string",
+         "userPhotoURL": "string",
+         "content": "string",
+         "timestamp": "timestamp",
+         "type": "string",
+         "reactions": {
+           "{userId}": "string"
+         },
+         "replyTo": "string",
+         "edited": "boolean",
+         "editedAt": "timestamp"
+       }
+     }
+   },
+ 
+   "groupLocations": {
+     "{vacationId}": {
+       "members": {
+         "{userId}": {
+           "userName": "string",
+           "userPhotoURL": "string",
+           "isSharing": "boolean",
+           "lastUpdated": "timestamp",
+           "location": {
+             "latitude": "number",
+             "longitude": "number",
+             "accuracy": "number",
+             "parkId": "string",
+             "areaId": "string",
+             "attractionId": "string",
+             "name": "string"
+           }
+         }
+       },
+       "updates": {
+         "{updateId}": {
+           "userId": "string",
+           "userName": "string",
+           "userPhotoURL": "string",
+           "location": {
+             "latitude": "number",
+             "longitude": "number",
+             "accuracy": "number",
+             "parkId": "string",
+             "areaId": "string",
+             "attractionId": "string",
+             "name": "string"
+           },
+           "message": "string",
+           "timestamp": "timestamp",
+           "isEmergency": "boolean"
+         }
+       }
+     }
+   },
+ 
+   "liveWaitTimes": {
+     "{parkId}": {
+       "lastUpdated": "timestamp",
+       "attractions": {
+         "{attractionId}": {
+           "status": "string",
+           "standbyWait": "number",
+           "lightningLane": {
+             "available": "boolean",
+             "nextReturnTime": "string",
+             "price": "number"
+           },
+           "lastUpdated": "timestamp"
+         }
+       }
+     }
+   },
+ 
+   "notifications": {
+     "{userId}": {
+       "{notificationId}": {
+         "type": "string",
+         "title": "string",
+         "message": "string",
+         "data": "object",
+         "timestamp": "timestamp",
+         "read": "boolean",
+         "vacationId": "string"
+       }
+     }
+   }
+ }
+ ```
+ 
+ ## Components & Hooks
+ 
+ ### Core Service Module
+ 
+ **File**: `src/lib/firebase/realtime-database.ts`
+ 
+ This module provides all the necessary functions for interacting with Firebase Realtime Database:
+ 
+ - User management functions
+ - Vacation management
+ - Real-time messaging
+ - Location sharing
+ - Wait times management
+ - Notifications
+ - Utility functions
+ 
+ ### React Hooks
+ 
+ **File**: `src/hooks/useRealtimeDatabase.ts`
+ 
+ Provides custom React hooks for easy integration:
+ 
+ - `useGroupMessages()` - Real-time group chat
+ - `useLocationSharing()` - Location updates and sharing
+ - `useWaitTimes()` - Park wait times
+ - `useNotifications()` - User notifications
+ - `useVacationRealtime()` - Combined hook for all features
+ 
+ ### UI Components
+ 
+ **GroupChat Component**: `src/components/group/GroupChat.tsx`
+ - Real-time messaging interface
+ - Message reactions
+ - Auto-scroll functionality
+ - Typing indicators
+ 
+ **LocationSharing Component**: `src/components/group/LocationSharing.tsx`
+ - Location sharing toggle
+ - Emergency location sharing
+ - Group member locations
+ - Location history
+ 
+ ## Security Rules
+ 
+ Add these security rules to your Firebase Realtime Database:
+ 
+ ```json
+ {
+   "rules": {
+     "users": {
+       "$userId": {
+         ".read": "auth != null && auth.uid == $userId",
+         ".write": "auth != null && auth.uid == $userId"
+       }
+     },
+     "vacations": {
+       "$vacationId": {
+         ".read": "auth != null && exists(/vacations/$vacationId/members/auth.uid)",
+         ".write": "auth != null && exists(/vacations/$vacationId/members/auth.uid)"
+       }
+     },
+     "groupMessages": {
+       "$vacationId": {
+         ".read": "auth != null && exists(/vacations/$vacationId/members/auth.uid)",
+         "$messageId": {
+           ".write": "auth != null && exists(/vacations/$vacationId/members/auth.uid)"
+         }
+       }
+     },
+     "groupLocations": {
+       "$vacationId": {
+         ".read": "auth != null && exists(/vacations/$vacationId/members/auth.uid)",
+         "members": {
+           "$userId": {
+             ".write": "auth != null && auth.uid == $userId"
+           }
+         },
+         "updates": {
+           "$updateId": {
+             ".write": "auth != null && exists(/vacations/$vacationId/members/auth.uid)"
+           }
+         }
+       }
+     },
+     "liveWaitTimes": {
+       ".read": "auth != null",
+       ".write": "false"
+     },
+     "notifications": {
+       "$userId": {
+         ".read": "auth != null && auth.uid == $userId",
+         ".write": "auth != null"
+       }
+     }
+   }
+ }
+ ```
+ 
+ ## Usage Examples
+ 
+ ### Basic Setup
+ 
+ ```typescript
+ import { useVacationRealtime } from '@/hooks/useRealtimeDatabase'
+ 
+ function VacationDashboard({ vacationId }: { vacationId: string }) {
+   const {
+     messages,
+     locationSharing,
+     notifications,
+     isLoading,
+     hasError
+   } = useVacationRealtime(vacationId)
+ 
+   if (isLoading) return <div>Loading...</div>
+   if (hasError) return <div>Error loading data</div>
+ 
+   return (
+     <div>
+       <GroupChat vacationId={vacationId} />
+       <LocationSharing vacationId={vacationId} />
+     </div>
+   )
+ }
+ ```
+ 
+ ### Sending Messages
+ 
+ ```typescript
+ import { useGroupMessages } from '@/hooks/useRealtimeDatabase'
+ 
+ function ChatComponent({ vacationId }: { vacationId: string }) {
+   const { messages, sendMessage, addReaction } = useGroupMessages(vacationId)
+ 
+   const handleSendMessage = async (content: string) => {
+     try {
+       await sendMessage(content)
+     } catch (error) {
+       console.error('Failed to send message:', error)
+     }
+   }
+ 
+   return (
+     <div>
+       {/* Chat UI */}
+     </div>
+   )
+ }
+ ```
+ 
+ ### Location Sharing
+ 
+ ```typescript
+ import { useLocationSharing } from '@/hooks/useRealtimeDatabase'
+ 
+ function LocationComponent({ vacationId }: { vacationId: string }) {
+   const {
+     memberLocations,
+     toggleLocationSharing,
+     shareLocation
+   } = useLocationSharing(vacationId)
+ 
+   const handleEmergencyShare = async () => {
+     navigator.geolocation.getCurrentPosition(async (position) => {
+       await shareLocation(
+         {
+           latitude: position.coords.latitude,
+           longitude: position.coords.longitude,
+           name: 'Emergency Location'
+         },
+         'Need help!',
+         true // isEmergency
+       )
+     })
+   }
+ 
+   return (
+     <div>
+       {/* Location UI */}
+     </div>
+   )
+ }
+ ```
+ 
+ ## Best Practices
+ 
+ ### Data Structure
+ - Keep data flat to avoid deep nesting
+ - Denormalize data when necessary for performance
+ - Use push IDs for list items
+ - Store timestamps as numbers (Date.now())
+ 
+ ### Performance
+ - Use limits on queries to avoid downloading too much data
+ - Implement pagination for large datasets
+ - Use offline persistence for better user experience
+ - Clean up listeners in useEffect cleanup functions
+ 
+ ### Security
+ - Always validate data on both client and server
+ - Use Firebase Security Rules to protect data
+ - Don't store sensitive information in Realtime Database
+ - Implement rate limiting for write operations
+ 
+ ### Error Handling
+ - Wrap database operations in try-catch blocks
+ - Provide meaningful error messages to users
+ - Log errors for debugging
+ - Implement retry logic for failed operations
+ 
+ ### Real-time Updates
+ - Use listeners only when necessary
+ - Remove listeners to prevent memory leaks
+ - Handle connection state changes
+ - Implement optimistic updates for better UX
+ 
+ ## Troubleshooting
+ 
+ ### Common Issues
+ 
+ **1. Permission Denied Errors**
+ - Check Firebase Security Rules
+ - Ensure user is authenticated
+ - Verify user has access to the resource
+ 
+ **2. Data Not Syncing**
+ - Check internet connection
+ - Verify Firebase configuration
+ - Check for JavaScript errors in console
+ 
+ **3. Performance Issues**
+ - Limit query results
+ - Remove unused listeners
+ - Check for deep nesting in data structure
+ 
+ **4. Authentication Issues**
+ - Verify Firebase Auth is working
+ - Check user session persistence
+ - Ensure proper error handling
+ 
+ ### Debugging Tips
+ 
+ 1. **Use Firebase Console**: Monitor real-time data changes
+ 2. **Enable Debug Logging**: Add logging to your functions
+ 3. **Check Network Tab**: Monitor WebSocket connections
+ 4. **Use React DevTools**: Inspect hook states and props
+ 
+ ### Getting Help
+ 
+ - [Firebase Documentation](https://firebase.google.com/docs/database)
+ - [Firebase Support](https://firebase.google.com/support)
+ - [Stack Overflow](https://stackoverflow.com/questions/tagged/firebase-realtime-database)
+ 
+ ## Conclusion
+ 
+ This Firebase Realtime Database implementation provides a robust foundation for real-time collaboration features in the Disney vacation planning app. The flattened data structure, comprehensive security rules, and React hooks ensure good performance, security, and developer experience.
+ 
+ Remember to regularly review and update security rules, monitor performance metrics, and keep the Firebase SDK updated to the latest version.
```

---



---

